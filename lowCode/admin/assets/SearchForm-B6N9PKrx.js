import{r as i,j as s,B as f,R as O}from"./index-BrD5sXbN.js";import{a as m,i as W,g as _,b as q,d as z,M as G,e as J}from"./Page-xyqr89RQ.js";import{R as K,i as Q}from"./index-Btp2qndV.js";import{u as U}from"./pageStore-D-Vypx31.js";import{FormContext as X}from"./context-D17HXmSO.js";import b from"./index.module-BHwNohRk.js";import{F as D}from"./index-CiNuIwYW.js";import{S as Y,R as Z}from"./DoubleRightOutlined-BBqvPxX4.js";import{R as ee}from"./index-BTJ7lNGW.js";import{R as te}from"./util-DHOYMMeV.js";import"./tslib.es6-DQF7CiZa.js";import"./index-QqHQ6VDD.js";import"./index-D8qpNAOl.js";import"./index-F3O87iVt.js";import"./LockOutlined-CXcM9Ypx.js";import"./UserOutlined-ueenOKIG.js";const se=({id:l,type:ae,config:c,elements:n,onSearch:x,onChange:d,onReset:h},k)=>{var V;const[o]=D.useForm(),F=i.useRef(null),[p,I]=i.useState(!1),[S,j]=i.useState(!1),[E,y]=i.useState(!0),[N,T]=i.useState({}),{formData:g,setFormData:u}=U(e=>({formData:e.page.pageData.formData,setFormData:e.setFormData}));i.useEffect(()=>{setTimeout(()=>{var e;((e=F.current)==null?void 0:e.offsetTop)>=32&&n.length>0?j(!0):j(!1)},500)},[n]);const A=()=>{const e=o.getFieldsValue();x&&x(m(n,e))},L=()=>{o.resetFields();const e=o.getFieldsValue();h&&h(m(n,e)),u({name:l,value:e,type:"override"})},P=(e,t)=>{const a=m(n,t);d==null||d(a),u({name:l,value:a})};i.useImperativeHandle(k,()=>({show(){y(!0)},hide(){y(!1)},reset(){o.resetFields(),u({name:l,value:o.getFieldsValue(),type:"override"})},submit(){o.submit()},init(e={}){const t=m(n,e);o.setFieldsValue(t),u({name:l,value:t})},getFormData(e){var t;return e&&typeof e=="string"?(t=g[l])==null?void 0:t[e]:g[l]}}));const $=e=>{const t=o.getFieldsValue(),a=m(n,t),r=c.events.find(H=>H.eventName===e);J(r==null?void 0:r.actions,a)},w=()=>{I(!p)},{submitText:R,resetText:v}=c.props.form||{},B=c.props.bulkActionList||[],C=i.useCallback((e,t,a)=>{if(t&&W(a)){let r=a;e==="InputNumber"&&(r=Number(a)),e==="DatePicker"&&(r=_(a)),e==="DatePickerRange"&&(r=q(a)),e==="TimePicker"&&(r=z(a,"HH:mm:ss")),T({[t]:r}),o.setFieldValue([t],r),u({name:l,value:{[t]:r}})}},[]),M=Q;return E&&s.jsx(X.Provider,{value:{initValues:C},children:s.jsxs(D,{form:o,layout:"inline",style:c.style,initialValues:N,onValuesChange:P,children:[s.jsxs("div",{className:b.formWrap,style:p?{}:{height:32,overflow:"hidden"},children:[s.jsx(G,{elements:n}),s.jsx("div",{ref:F})]}),s.jsxs(Y,{style:{alignItems:"baseline",marginLeft:10},children:[R?s.jsx(f,{type:"primary",icon:s.jsx(ee,{}),onClick:A,children:R}):null,v?s.jsx(f,{type:"default",icon:s.jsx(K,{}),onClick:L,children:v}):null,B.length>0&&s.jsx("div",{className:b.action,children:(V=c.props.bulkActionList)==null?void 0:V.map((e,t)=>s.jsx(f,{type:e.type,danger:e.danger,icon:e.icon?O.createElement(M[e.icon]):null,onClick:()=>$(e.eventName),children:e.text},`bulkAction${t}`))}),S&&s.jsx(f,{type:"link",icon:p?s.jsx(te,{}):s.jsx(Z,{}),onClick:w,children:p?"收起":"展开"})]})]})})},ge=i.forwardRef(se);export{ge as default};
