import{r,j as n}from"./index-BrD5sXbN.js";import{h as W,i as v}from"./Page-xyqr89RQ.js";import{useFormContext as j}from"./context-D17HXmSO.js";import{u as V}from"./pageStore-D-Vypx31.js";import{F as A}from"./index-CiNuIwYW.js";import{S as F}from"./tslib.es6-DQF7CiZa.js";import"./util-DHOYMMeV.js";import"./DoubleRightOutlined-BBqvPxX4.js";import"./index-BTJ7lNGW.js";import"./index-QqHQ6VDD.js";import"./index-D8qpNAOl.js";import"./index-F3O87iVt.js";const w=({type:y,config:e,onChange:o},c)=>{var d;const[h,m]=r.useState([]),{initValues:S}=j(),[x,i]=r.useState(!0),[D,l]=r.useState(),E=V(a=>a.page.pageData.variableData);r.useEffect(()=>{var s;const a=(s=e.props.formItem)==null?void 0:s.name,t=e.props.defaultValue;S(y,a,t)},[e.props.defaultValue]),r.useEffect(()=>{typeof e.props.formWrap.disabled=="boolean"&&l(e.props.formWrap.disabled)},[e.props.formWrap.disabled]),r.useEffect(()=>{u({})},[e.api,((d=e.api)==null?void 0:d.sourceType)=="variable"?E:""]);const u=a=>{W(e.api,a).then(t=>{if((t==null?void 0:t.code)===0)if(!Array.isArray(t.data))console.error("[select]","data数据格式错误，请检查"),m([]);else{let s=[];e.props.field.label==="label"&&e.props.field.value==="value"?(s=t.data,(typeof t.data[0]=="string"||typeof t.data[0]=="number")&&(s=t.data.map(p=>({label:p,value:p})))):s=t.data.map(p=>{const f=p[e.props.field.label||"label"],b=p[e.props.field.value||"value"];return{label:v(f)?f:"-",value:v(b)?b:""}}),m(s)}})};r.useImperativeHandle(c,()=>({show(){i(!0)},hide(){i(!1)},enable(){l(!1)},disable(){l(!0)},update:a=>{u(a)}}));const I=a=>{o&&o({[e.props.formItem.name]:a})};return x&&n.jsx(A.Item,{...e.props.formItem,children:n.jsx(F,{...e.props.formWrap,disabled:D,variant:e.props.formWrap.variant||void 0,options:h,style:e.style,onChange:a=>I(a)})})},B=r.forwardRef(w);export{B as default};
