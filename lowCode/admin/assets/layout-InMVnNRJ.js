import{b,u as I,r as u,j as e,c as S,R as T,C as R,z as K,a as O,s as C,O as P,A as U,D as W}from"./index-DzwVQ2UK.js";import{u as D}from"./pageStore-CahLOgRM.js";import{u as v}from"./projectStore-GWkWPqkJ.js";import{u as z,g as A,B as X,a as Y}from"./util-D3GCZG9x.js";import{i as G,a as J,b as Q}from"./index-DzVzGntI.js";import{M as V,F as N,D as Z,S as ee,R as te,T as oe,L as M}from"./DoubleRightOutlined-oEBZ4Nyz.js";import{d as se,l as ne}from"./styled-components.browser.esm-CJxcUcuY.js";import"./index-Bz8JGjyY.js";import"./LockOutlined-CX7LeA3k.js";import"./index-ytCQesj7.js";import"./UserOutlined-DaF8R1KZ.js";const ae="_logo_145u9_1",re="_logoName_145u9_14",_={logo:ae,logoName:re};function B(){const{collapsed:l,projectInfo:t}=v(),r=b(),{projectId:h}=I(),[m,c]=u.useState({}),[s,i]=u.useState({});return u.useEffect(()=>{t.menuThemeColor==="dark"?c({backgroundColor:"#001529",color:"#fff",height:64,padding:"10px 20px"}):c({backgroundColor:"#fff",color:"#000",height:64,padding:"10px 20px"}),/^[\u4e00-\u9fa5]+$/.test(t.name)&&i({fontSize:t.name.length>9?14:16})},[t.layout,t.menuThemeColor]),e.jsxs("div",{className:_.logo,onClick:()=>{r(`/project/${h}/welcome`)},style:m,children:[e.jsx("img",{src:t.logo||"/imgs/mars-logo.png"}),!l&&e.jsx("span",{className:_.logoName,style:s,children:t.name})]})}function F(){const{projectId:l}=I(),[t,r]=u.useState([]),{pathname:h}=S(),{pageMap:m,menuMap:c}=v(z(s=>({pageMap:s.pageMap,menuMap:s.menuMap})));return u.useEffect(()=>{if(!l)return;const s=h.split(l)[1].slice(1),i=A(s,m);if(!i)return;const a=m[Number(i)];if(h.endsWith("/welcome")){r([{title:"欢迎页"}]);return}if(!a)return;const f=[];let g=a;for(;g;)f.unshift({title:g.name}),g=c[g.parentId];r(f)},[h,c]),e.jsx(X,{className:"layout-bread-crumb",items:t})}const q=()=>{const[l,t]=u.useState([]),[r,h]=u.useState([]),m=b(),{pathname:c}=S(),{projectId:s}=I(),{collapsed:i,menuTree:a,projectInfo:f}=v();u.useEffect(()=>{const n=g(a);t(n)},[a]),u.useEffect(()=>{h([c])},[c]);const g=(n,p=[])=>(n.forEach(o=>{var j;if(o.type===1&&o.status===1){const x=G;if((j=o.buttons)!=null&&j.length||!o.children){const w=`/project/${s}/${o.path.startsWith("/")?o.path.slice(1):o.path||o.pageId||-o.id}`;return p.push(y(o.name,w,x[o.icon]&&T.createElement(x[o.icon])))}const k=`${s}-${o.id}`;p.push(y(o.name,k,x[o.icon]&&T.createElement(x[o.icon]),g(o.children||[])))}}),p);function y(n,p,o,j,x){return(j==null?void 0:j.length)===0&&(j=void 0),{key:p,icon:o,children:j,label:n,type:x}}const d=n=>{const p=n.key;c!==p&&(Number(n.key.split("/").slice(-1)[0])<0?m("notPublish"):m(p))};return e.jsx("div",{style:f.menuMode==="horizontal"?{width:"calc(100vw - 458px)"}:{width:i?79:255,background:f.menuThemeColor==="light"?"#fff":"#001529",borderRight:f.layout===2?"1px solid #e8e9eb":"none",overflowX:"hidden"},children:e.jsx(R,{theme:{components:{Menu:{darkItemColor:"#fff",darkItemHoverColor:f.systemThemeColor,iconSize:16}}},children:e.jsx(V,{onClick:d,theme:f.menuThemeColor,selectedKeys:r,style:f.menuMode==="horizontal"?{}:{height:"calc(100vh - 64px)",border:"none",overflowY:"auto"},mode:f.menuMode,inlineCollapsed:f.menuMode==="horizontal"?void 0:i,items:l})})})},ce="_header_1imqu_1",le="_menu_1imqu_16",ie="_user_1imqu_22",ue="_publishPopover_1imqu_26",E={header:ce,menu:le,user:ie,publishPopover:ue},$=u.memo(()=>{const l=D(a=>a.userInfo),{projectInfo:t,collapsed:r,updateCollapsed:h}=v(),m=b(),c=()=>{h()},s=t.menuThemeColor==="light"||t.layout===1,i={backgroundColor:s?"#fff":"#001529",color:t.menuThemeColor==="light"?"#000":"#fff"};return e.jsxs("div",{className:E.header,style:i,children:[t.layout===1?e.jsxs(N,{align:"center",children:[e.jsx("div",{onClick:c,style:{cursor:"pointer"},children:r?e.jsx(J,{style:{color:s?"#000":"#fff"}}):e.jsx(Q,{style:{color:s?"#000":"#fff"}})}),t.breadcrumb===1&&e.jsx(F,{})]}):null,t.layout===2?e.jsxs(N,{align:"center",children:[e.jsx(B,{}),e.jsx(q,{})]}):null,e.jsxs("div",{className:E.user,children:[l.avatar?e.jsx("img",{width:30,src:l.avatar,style:{borderRadius:"100%"}}):null,e.jsx(Z,{menu:{items:[{key:"profile",label:l.nickName},{key:"logout",label:"退出"}],onClick:({key:a})=>{a==="logout"&&(localStorage.clear(),m(`/login?callback=${window.location.href}`))},selectable:!0},children:e.jsx("a",{onClick:a=>a.preventDefault(),children:e.jsxs(ee,{children:[e.jsx("span",{style:{marginLeft:"10px",color:s?"":"#fff"},children:`${l.nickName}`||"开发者"}),e.jsx(te,{})]})})})]})]})});function L(){const l=b(),[t,r]=u.useState([{label:"欢迎页",key:"welcome",closable:!1}]),[h,m]=u.useState(""),{projectId:c}=I(),{pathname:s}=S(),i=v(z(d=>d.pageMap));u.useEffect(()=>{a()},[s,i]);const a=()=>{if(!c)return;const d=s.split(c)[1].slice(1),n=A(d,i),p=i[Number(n)];p&&(t.find(o=>o.key.includes(s))||t.push({key:s+location.search,label:p.name,closable:!0}),r([...t]),m(s+location.search))},f=d=>{s===d&&t.forEach((n,p)=>{if(n.key!=s)return;const o=t[p+1]||t[p-1];o&&l(o.key)}),r(t.filter(n=>n.key!=d))},g=d=>{f(d)},y=d=>{if(d==="welcome")return l("welcome");l(d)};return e.jsx(oe,{type:"editable-card",hideAdd:!0,activeKey:h,items:t,onChange:y,onEdit:g,tabBarStyle:{marginBottom:0,backgroundColor:"#fff",paddingTop:10}})}const de=se.img`
  position: fixed;
  top: 0;
  left: 0;
  z-index: 999999;
  pointer-events: none;
`,ke=()=>{const{collapsed:l,setProjectInfo:t,projectInfo:r}=v(n=>({collapsed:n.collapsed,setProjectInfo:n.setProjectInfo,projectInfo:n.projectInfo})),h=D(n=>n.saveUserInfo),m=K(),c=b(),[s,i]=u.useState(""),{projectId:a}=I(),[f]=O(),{pathname:g}=S();u.useEffect(()=>{m&&h(m)},[]),u.useEffect(()=>{if(a&&isNaN(+a))return c("/404?type=project");const n=f.get("env")||C.get(`${a}-env`)||"prd";C.set(`${a}-env`,n),i(n==="stg"?"/imgs/env-stg.svg":n==="pre"?"/imgs/env-pre.svg":""),(async()=>{if(a){const o=await U(a).catch(()=>c("/403?type=project"));if(!o.id)return c("/404?type=project");const j=await W(a).catch(()=>c("/403?type=project"));if(!j)return;/project\/\d+\/\w+/.test(g)||c(`/project/${a}/welcome`);const{menuTree:x,buttons:k,pageMap:w,menuMap:H}=Y(j.list);C.set("buttons",k),C.set("pageMap",w),t({projectInfo:o,menuTree:x,buttons:k,pageMap:w,menuMap:H})}})()},[a]);const y=u.useMemo(()=>r.tag?"calc(100vh - 114px)":"calc(100vh - 64px)",[r.tag]),d=()=>e.jsx(M.Footer,{children:e.jsx("div",{className:"footnote",children:e.jsx("span",{children:"Copyright © 2024 Marsview. All Rights Reserved. "})})});return e.jsxs(R,{locale:ne,theme:{token:{colorPrimary:r.systemThemeColor||"#1677ff"},hashed:!1},children:[s&&e.jsx(de,{src:s}),e.jsxs(M,{children:[r.layout===1&&e.jsxs(M,{style:{flexDirection:"row"},children:[e.jsxs("div",{style:{width:l?80:256,borderRight:"1px solid #e8e9eb"},children:[e.jsx(B,{}),e.jsx(q,{})]}),e.jsxs("div",{style:{width:l?"calc(100vw - 80px)":"calc(100vw - 256px)"},children:[e.jsx($,{}),r.tag===1&&e.jsx(L,{}),e.jsxs("div",{style:{height:y,overflow:"auto"},children:[e.jsx(P,{}),r.footer===1&&e.jsx(d,{})]})]})]}),r.layout===2&&e.jsxs(e.Fragment,{children:[e.jsx($,{}),r.tag?e.jsx(L,{}):null,e.jsxs(M,{style:{padding:20,backgroundColor:"#f3f5f9",height:y,overflow:"auto"},children:[r.breadcrumb===1&&e.jsx(F,{}),e.jsx(P,{}),r.footer===1&&e.jsx(d,{})]})]})]})]})};export{ke as default};
