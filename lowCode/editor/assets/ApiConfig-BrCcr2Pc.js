import{a as f,r as c,j as e,T as b,B as C}from"./index-CY1Ymj4r.js";import{u as S}from"./index-DGBlI9oV.js";import{S as V}from"./SettingModal-B-iGUT5G.js";import{V as d}from"./VsEditor-Bn3NW5Dw.js";import{V as u}from"./VariableBind-g8cMkMZP.js";import{F as r}from"./index-BKDg-K48.js";import{R as E}from"./QuestionCircleOutlined-TTJW15q1.js";import{S as n}from"./index-CUKOry-Y.js";import{R as T}from"./EditOutlined-JZ6BD8WC.js";import"./debounce-HTNO8IKQ.js";import"./index-Du8QL6nv.js";import"./index-C1u3Ql-g.js";import"./BaseInput-Bka7TPzR.js";import"./TextArea-U5uDgpR6.js";import"./useVariants-B4R8rkTL.js";import"./EyeInvisibleOutlined-DDX5Jvzv.js";import"./EyeOutlined-B6CobvGR.js";import"./SearchOutlined-DZ2l1XJ5.js";import"./index-CrCWvzoA.js";import"./index-CVwKh-ii.js";import"./PlusOutlined-dRNvmZ2Y.js";import"./NotificationOutlined-C3CDmrw2.js";import"./InfoCircleOutlined-DWZ7nUzE.js";import"./index-BnlvMKaU.js";import"./DownOutlined-QYs-kCMH.js";import"./UpOutlined-Bu3BOxje.js";import"./index-ClLmsWSS.js";import"./index-Tz3gITLY.js";import"./util-UBnOudtO.js";import"./index-yDMkoRSw.js";import"./_baseGet-C1wBFXxd.js";import"./index-BpGeudkR.js";import"./index-BqJLt5d9.js";import"./List-CfIaGhIa.js";import"./conductUtil-oPofkrzY.js";import"./PlusSquareOutlined-D3cnUxWk.js";import"./FolderOpenOutlined-CDyAvlLT.js";import"./HolderOutlined-E1hrqN51.js";import"./index-CMyR3-Rp.js";import"./FunctionOutlined-D3UO96Yh.js";import"./row-C5ps4gU6.js";import"./useShowArrow-C9phI0pM.js";import"./index-DYezmHfp.js";import"./useIcons-CYuILU2n.js";const O="_title_k50i9_1",w={title:O},Ie=()=>{const o=f(),[i]=r.useForm(),[h,m]=c.useState("json"),a=c.useRef();c.useEffect(()=>{var l;i.resetFields();let t;o.selectedElement?t=((l=o.page.pageData.elementsMap[o.selectedElement.id])==null?void 0:l.config.api)||{}:t=o.page.pageData.config.api||{},m((t==null?void 0:t.sourceType)||"json");const s=JSON.stringify((t==null?void 0:t.source)||"",null,2);i.setFieldsValue({sourceType:"json",id:"",sourceField:"",...t,source:s})},[o.selectedElement]);const y=t=>{m(t)};function F(){var t;(t=a.current)==null||t.showModal(i.getFieldValue("id"))}const{run:I}=S(()=>{j(i.getFieldValue("id"))},{wait:800}),j=t=>{var x,g;const s=i.getFieldsValue();let l=[];try{l=JSON.parse(s.source)}catch(p){console.error(p),l=[]}if((x=o.selectedElement)!=null&&x.id){const p={id:(g=o.selectedElement)==null?void 0:g.id,type:"api",api:{...s,id:t,source:l}};o.editElement(p)}else{const p={type:"api",api:{...s,id:t,source:l}};o.savePageInfo(p)}t&&i.setFieldValue("id",t)};return e.jsxs(r,{form:i,labelCol:{span:8},wrapperCol:{span:15},labelAlign:"right",onValuesChange:I,autoComplete:"off",children:[e.jsxs("h2",{className:w.title,children:[e.jsx("span",{children:"数据源配置"}),e.jsx(b,{title:"支持mock数据、接口请求和变量绑定",children:e.jsx(E,{style:{marginLeft:5}})})]}),e.jsx(r.Item,{label:"数据来源",name:"sourceType",children:e.jsxs(n,{onChange:t=>y(t),children:[e.jsx(n.Option,{value:"json",children:"静态数据"}),e.jsx(n.Option,{value:"api",children:"接口请求"}),e.jsx(n.Option,{value:"variable",children:"动态变量"})]})}),e.jsx(r.Item,{noStyle:!0,shouldUpdate:!0,children:t=>{const s=t.getFieldValue("sourceType");if(s==="json")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{name:"source",noStyle:!0,children:e.jsx(d,{height:"300px",language:"json"})}),e.jsx(r.Item,{label:"数据处理",name:"sourceField",tooltip:"示例：{ code:0 ,data:{ list: [], total: 10 } } ，字段对应是list，默认可不填。",children:e.jsx(u,{placeholder:"返回值字段映射,eg: data.list"})})]});if(s==="api")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{label:"请求地址",name:"id",children:e.jsx(R,{showModal:F})}),e.jsx(r.Item,{label:"数据处理",name:"sourceField",tooltip:"示例：{ code:0 ,data:{ list: [], total: 10 } } ，字段对应是data.list.",children:e.jsx(u,{placeholder:"字段映射,eg: data.list"})}),e.jsx(r.Item,{name:"source",hidden:!0,children:e.jsx(d,{height:"350px",language:"json"})})]});if(s==="variable")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{label:"绑定变量",name:"name",children:e.jsx(u,{readOnly:!0,placeholder:"数据源所对应的接口字段"})}),e.jsx(r.Item,{name:"source",hidden:!0,children:e.jsx(d,{height:"350px",language:"json"})})]})}}),e.jsx(V,{update:j,ref:a})]})};function R({value:o,onChange:i,showModal:h}){const m=f();return e.jsxs(e.Fragment,{children:[e.jsx(n,{placeholder:"请选择接口",showSearch:!0,allowClear:!0,style:{width:"82%"},value:o,onChange:a=>i(a),children:Object.values(m.page.pageData.apis).map(a=>e.jsx(n.Option,{value:a.id,children:a.name},a.id))}),e.jsx(C,{type:"link",onClick:h,icon:e.jsx(T,{})})]})}export{Ie as default};
