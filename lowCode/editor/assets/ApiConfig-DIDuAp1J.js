import{a as f,r as c,j as e,T as b,B as C}from"./index-DmOc0qNU.js";import{u as S}from"./index-CrdplzP2.js";import{S as V}from"./SettingModal-DRclkpPm.js";import{V as d}from"./VsEditor-DbAzcx7k.js";import{V as u}from"./VariableBind-alrlGhmD.js";import{F as r}from"./index-1_6nT-oA.js";import{R as E}from"./QuestionCircleOutlined-Dza1yYuv.js";import{S as n}from"./index-DSaINUG7.js";import{R as T}from"./EditOutlined-D6nYSc60.js";import"./debounce-CoSCf5Zb.js";import"./index-B-YUPJxN.js";import"./index-DOHCQObp.js";import"./BaseInput-4F0kfgVN.js";import"./TextArea-D7VuO_-I.js";import"./useVariants-BdxfBOl3.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./EyeOutlined-QFSiY36E.js";import"./SearchOutlined-DscCkqW9.js";import"./index-DxJl0Bxc.js";import"./index-B5-G8EA2.js";import"./PlusOutlined-BSTEPWl7.js";import"./NotificationOutlined-DlRBMYlM.js";import"./InfoCircleOutlined-D9lj3ic_.js";import"./index-o7l-rjNw.js";import"./DownOutlined-DnWdyoG8.js";import"./UpOutlined-CkYvBYD1.js";import"./index-_pMv_sKm.js";import"./index-Dg1x3Ybx.js";import"./util-DNkFm-j2.js";import"./index-C0E5Fhz-.js";import"./_baseGet-xRkAGEE7.js";import"./index-sNbwzaq7.js";import"./index-B6d_3ZHh.js";import"./List-BV6fBbjc.js";import"./conductUtil-wNhCxpcs.js";import"./PlusSquareOutlined-D0i2U-a9.js";import"./FolderOpenOutlined-Bj6jPccg.js";import"./HolderOutlined-CzOeoeCY.js";import"./index-B2mTmS5H.js";import"./FunctionOutlined-Dm0pzJNb.js";import"./row-pIc0FM19.js";import"./useShowArrow-CIjY5B73.js";import"./index-wVmnK_0F.js";import"./useIcons-CLAJNkrF.js";const O="_title_k50i9_1",w={title:O},Ie=()=>{const o=f(),[i]=r.useForm(),[h,m]=c.useState("json"),a=c.useRef();c.useEffect(()=>{var l;i.resetFields();let t;o.selectedElement?t=((l=o.page.pageData.elementsMap[o.selectedElement.id])==null?void 0:l.config.api)||{}:t=o.page.pageData.config.api||{},m((t==null?void 0:t.sourceType)||"json");const s=JSON.stringify((t==null?void 0:t.source)||"",null,2);i.setFieldsValue({sourceType:"json",id:"",sourceField:"",...t,source:s})},[o.selectedElement]);const y=t=>{m(t)};function F(){var t;(t=a.current)==null||t.showModal(i.getFieldValue("id"))}const{run:I}=S(()=>{j(i.getFieldValue("id"))},{wait:800}),j=t=>{var x,g;const s=i.getFieldsValue();let l=[];try{l=JSON.parse(s.source)}catch(p){console.error(p),l=[]}if((x=o.selectedElement)!=null&&x.id){const p={id:(g=o.selectedElement)==null?void 0:g.id,type:"api",api:{...s,id:t,source:l}};o.editElement(p)}else{const p={type:"api",api:{...s,id:t,source:l}};o.savePageInfo(p)}t&&i.setFieldValue("id",t)};return e.jsxs(r,{form:i,labelCol:{span:8},wrapperCol:{span:15},labelAlign:"right",onValuesChange:I,autoComplete:"off",children:[e.jsxs("h2",{className:w.title,children:[e.jsx("span",{children:"数据源配置"}),e.jsx(b,{title:"支持mock数据、接口请求和变量绑定",children:e.jsx(E,{style:{marginLeft:5}})})]}),e.jsx(r.Item,{label:"数据来源",name:"sourceType",children:e.jsxs(n,{onChange:t=>y(t),children:[e.jsx(n.Option,{value:"json",children:"静态数据"}),e.jsx(n.Option,{value:"api",children:"接口请求"}),e.jsx(n.Option,{value:"variable",children:"动态变量"})]})}),e.jsx(r.Item,{noStyle:!0,shouldUpdate:!0,children:t=>{const s=t.getFieldValue("sourceType");if(s==="json")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{name:"source",noStyle:!0,children:e.jsx(d,{height:"300px",language:"json"})}),e.jsx(r.Item,{label:"数据处理",name:"sourceField",tooltip:"示例：{ code:0 ,data:{ list: [], total: 10 } } ，字段对应是list，默认可不填。",children:e.jsx(u,{placeholder:"返回值字段映射,eg: data.list"})})]});if(s==="api")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{label:"请求地址",name:"id",children:e.jsx(R,{showModal:F})}),e.jsx(r.Item,{label:"数据处理",name:"sourceField",tooltip:"示例：{ code:0 ,data:{ list: [], total: 10 } } ，字段对应是data.list.",children:e.jsx(u,{placeholder:"字段映射,eg: data.list"})}),e.jsx(r.Item,{name:"source",hidden:!0,children:e.jsx(d,{height:"350px",language:"json"})})]});if(s==="variable")return e.jsxs(e.Fragment,{children:[e.jsx(r.Item,{label:"绑定变量",name:"name",children:e.jsx(u,{readOnly:!0,placeholder:"数据源所对应的接口字段"})}),e.jsx(r.Item,{name:"source",hidden:!0,children:e.jsx(d,{height:"350px",language:"json"})})]})}}),e.jsx(V,{update:j,ref:a})]})};function R({value:o,onChange:i,showModal:h}){const m=f();return e.jsxs(e.Fragment,{children:[e.jsx(n,{placeholder:"请选择接口",showSearch:!0,allowClear:!0,style:{width:"82%"},value:o,onChange:a=>i(a),children:Object.values(m.page.pageData.apis).map(a=>e.jsx(n.Option,{value:a.id,children:a.name},a.id))}),e.jsx(C,{type:"link",onClick:h,icon:e.jsx(T,{})})]})}export{Ie as default};
