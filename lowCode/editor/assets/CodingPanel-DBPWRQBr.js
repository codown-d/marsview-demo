import{r as o,a as D,j as i,B as S,m as g,d as P}from"./index-DmOc0qNU.js";import{l as j,F as I}from"./index-sNbwzaq7.js";import{R as N}from"./row-pIc0FM19.js";const O=()=>{const t=o.useRef(null),[c,s]=o.useState(!1),{userInfo:l,theme:p,page:r,savePageInfo:f}=D(e=>({userInfo:e.userInfo,theme:e.theme,page:e.page,savePageInfo:e.savePageInfo}));j.config({paths:{vs:"/static/monaco-editor/vs"}});function m(e){var a;t.current=e,(a=t.current)==null||a.setValue(JSON.stringify({userInfo:l,page:r},null,2))}o.useEffect(()=>{var e;(e=t.current)==null||e.setValue(JSON.stringify({userInfo:l,page:r},null,2))},[r]);const d=async e=>{var u;e.stopPropagation();let a;try{a=JSON.parse((u=t.current)==null?void 0:u.getValue())||{}}catch{a={},g.error("页面数据格式异常，请检查重试");return}const{name:h,remark:v,pageData:y}=a.page,n={id:r.id,name:h,remark:v,pageData:JSON.stringify({...y,variableData:{},formData:{}})};s(!0);try{await P.updatePageData(n),s(!1),f({...n,pageData:JSON.parse(n.pageData)}),g.success("保存成功")}catch{s(!1)}};return i.jsxs(N,{style:{marginLeft:"-14px",marginRight:1},children:[i.jsx(I,{height:"calc(100vh - 170px)",language:"json",theme:p==="dark"?"vs-dark":"vs-light",options:{lineNumbers:"on",minimap:{enabled:!1}},onMount:m}),i.jsx(S,{block:!0,type:"primary",loading:c,style:{margin:15},onClick:e=>d(e),children:"保存"})]})};export{O as default};
