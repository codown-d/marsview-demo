import{r,b as L,a as k,j as a,i as v,ah as w,B as C,d as p,bF as P,bG as D,f as R,bH as H}from"./index-DmOc0qNU.js";import{p as N}from"./project-RurpUGJo.js";import{T}from"./TextArea-D7VuO_-I.js";import{F as n}from"./index-1_6nT-oA.js";import{M as V}from"./index-_pMv_sKm.js";import{I as M}from"./index-B-YUPJxN.js";import{S as O}from"./index-DSaINUG7.js";const J=i=>{const[l]=n.useForm(),[h,d]=r.useState(!1),[o,f]=r.useState("create"),[m,u]=r.useState(0),[j,g]=r.useState(!1),[I,S]=r.useState([]),[y]=L(),b=k(e=>e.savePageInfo);r.useImperativeHandle(i.createRef,()=>({async open(e,t){const{list:c=[]}=await N.getCategoryList({pageNum:1,pageSize:100});if(S(c.map(s=>({name:s.name,id:s.id,logo:s.logo,remark:s.remark}))),f(e),console.log(e),e==="edit")t&&u(t.id),l.setFieldsValue(t);else if(e==="copy")t&&u(t.id),l.setFieldsValue({...t,name:`${t==null?void 0:t.name}-副本`});else{const s=y.get("projectId")||(t==null?void 0:t.projectId);f("create"),u(0),s&&l.setFieldValue("projectId",Number(s))}d(!0)}}));const x=async()=>{var c;const e=l.getFieldsValue();if(await l.validateFields()){g(!0);try{if(o==="create"){console.log(e),await p.createPageData(e);let s=JSON.parse(localStorage.getItem("pageList")||"[]");localStorage.setItem("pageList",JSON.stringify([...s,P({},D,e,{id:crypto.randomUUID(),projectId:crypto.randomUUID(),updatedAt:R().format("YYYY MM DD HH:mm:ss")})]))}else o==="edit"?(await p.updatePageData({...e,id:m}),H("pageList",m+"",e),b({name:e==null?void 0:e.name,remark:e==null?void 0:e.remark,projectId:e==null?void 0:e.projectId})):await p.copyPageData({...e,id:m});(c=i.update)==null||c.call(i,"success"),l.resetFields(),d(!1),g(!1)}catch{g(!1)}}},F=()=>{var e;l.resetFields(),d(!1),(e=i.update)==null||e.call(i,"cancel")};return a.jsx(V,{title:o==="create"?"初始页面信息":o==="edit"?"编辑页面":"复制页面",open:h,confirmLoading:j,onOk:x,onCancel:F,width:500,okText:"确定",cancelText:"取消",footer:o==="create"?null:void 0,children:a.jsxs(n,{layout:"vertical",form:l,labelCol:{span:5},wrapperCol:{span:24},children:[a.jsx(n.Item,{label:"名称",name:"name",rules:[{required:!0,message:"请输入页面名称"}],children:a.jsx(M,{placeholder:"请输入页面名称",maxLength:15,showCount:!0})}),a.jsx(n.Item,{label:"描述",name:"remark",children:a.jsx(T,{autoSize:{minRows:4,maxRows:6},placeholder:"请输入描述",maxLength:100,showCount:!0})}),a.jsx(n.Item,{label:"所属项目",name:"projectId",rules:[{required:!0,message:"请选择所属项目"}],children:a.jsx(O,{placeholder:"请选择所属项目",options:I,fieldNames:{label:"name",value:"id"},optionRender:e=>a.jsxs(v,{children:[a.jsx("img",{src:e.data.logo,style:{maxWidth:50,maxHeight:50}}),a.jsxs(w,{vertical:!0,children:[a.jsx("span",{children:e.data.name}),a.jsx("span",{children:e.data.remark})]})]})})}),o=="create"?a.jsx(n.Item,{children:a.jsx(C,{block:!0,type:"primary",onClick:x,loading:j,children:"快速初始化"})}):null]})})};export{J as C};
