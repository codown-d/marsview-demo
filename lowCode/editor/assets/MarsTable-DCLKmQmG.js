import{aI as Kr,aJ as or,aK as Ur,aL as pr,aM as lr,aN as ur,aO as fr,aP as Y,aQ as zr,aR as J,aS as k,ai as rr,aT as Hr,aU as Yr,aV as _r,aW as Jr,aX as Qr,aY as qr,aZ as Xr,a_ as Zr,r as T,a as jr,j as f,B as U,T as dr,P as Wr,aF as Vr,i as kr,k as re}from"./index-CY1Ymj4r.js";import{i as ee}from"./index-C4qQ40vK.js";import{g as te}from"./index-Bkuj5IWs.js";import{M as ne}from"./MarsRender-B9LyhaO3.js";import{handleApi as ie}from"./handleApi-Bz3x1xZ4.js";import{handleActionFlow as cr}from"./action-BWjACvR_.js";import{g as wr,i as mr,f as gr,a as yr}from"./util-UBnOudtO.js";import z from"./index.module-CSgzbKW_.js";import{c as er,t as q,i as Pr,b as Rr,a as ae}from"./_baseGet-C1wBFXxd.js";import{T as hr}from"./index-ELXMiYH9.js";import{B as Z}from"./SoundOutlined-B7v31N9V.js";import{I as j}from"./index-BH8xWKmO.js";import{T as W}from"./index-BcUfWEv4.js";import{F as se}from"./Table-DKwxKTfy.js";import{u as oe}from"./useDrop-D9SfugPi.js";import"./AlignRightOutlined-BaOygGam.js";import"./UsergroupAddOutlined-DQ7Kwpsy.js";import"./RedoOutlined-CJagRpK4.js";import"./SwapRightOutlined-CcIdOt_e.js";import"./CaretDownOutlined-fvgXmNbc.js";import"./FilterFilled-S1ql0Sss.js";import"./ExclamationCircleOutlined-CkY-Dzll.js";import"./CopyOutlined-CQbFHu9s.js";import"./DeleteOutlined-BfdCKHnO.js";import"./MoreOutlined-BHx2P-s-.js";import"./DoubleRightOutlined-BcWxf5hS.js";import"./DownOutlined-QYs-kCMH.js";import"./EditOutlined-JZ6BD8WC.js";import"./EnterOutlined-DS0cowoX.js";import"./EyeInvisibleOutlined-DDX5Jvzv.js";import"./EyeOutlined-B6CobvGR.js";import"./PlusSquareOutlined-D3cnUxWk.js";import"./FolderOpenOutlined-CDyAvlLT.js";import"./FunctionOutlined-D3UO96Yh.js";import"./HolderOutlined-E1hrqN51.js";import"./InfoCircleOutlined-DWZ7nUzE.js";import"./TeamOutlined-BmFXVwN3.js";import"./NotificationOutlined-C3CDmrw2.js";import"./MinusOutlined-CsSa3QgW.js";import"./QuestionCircleOutlined-TTJW15q1.js";import"./SaveOutlined-CRp1-oFH.js";import"./ZoomOutOutlined-t4Key8LE.js";import"./SearchOutlined-DZ2l1XJ5.js";import"./SettingOutlined-B7WTL30f.js";import"./SyncOutlined-SA527A4F.js";import"./UpOutlined-Bu3BOxje.js";import"./WarningFilled-k-vsk_P7.js";import"./LockOutlined-Bzfo-a2y.js";import"./PlusOutlined-dRNvmZ2Y.js";import"./UserOutlined-CjZcwOl4.js";import"./useComponentRefs-BjsmN1lJ.js";import"./shallow-Bi0WipZC.js";import"./index-B0UeyOoa.js";import"./index-BKDg-K48.js";import"./row-C5ps4gU6.js";import"./scrollTo-hj5AlJ0c.js";import"./index-CUKOry-Y.js";import"./useShowArrow-C9phI0pM.js";import"./List-CfIaGhIa.js";import"./index-DYezmHfp.js";import"./useIcons-CYuILU2n.js";import"./useVariants-B4R8rkTL.js";import"./index-BC5zvAmk.js";import"./useBreakpoint-D-Sgac-T.js";import"./useForceUpdate-BsEHW89a.js";import"./index-DOjNdDXR.js";import"./index-C1u3Ql-g.js";import"./index-CrCWvzoA.js";import"./index-CVwKh-ii.js";import"./index-DBtJBM7q.js";import"./index-Tz3gITLY.js";import"./index-CksWDIx9.js";import"./conductUtil-oPofkrzY.js";import"./index-CMyR3-Rp.js";import"./index-B5fUo_Hm.js";import"./ColorPicker-CHT1xIcH.js";import"./index-CQwwCPyp.js";import"./index-jYDJ93V_.js";import"./index-BnlvMKaU.js";import"./BaseInput-Bka7TPzR.js";import"./index-Du8QL6nv.js";import"./TextArea-U5uDgpR6.js";import"./index-DQZxJH5O.js";import"./index-Sy3WWpq7.js";import"./index-BX8mFvI3.js";import"./extendsObject-keMuGWqj.js";import"./Pagination-BhehRHa0.js";import"./index-ClLmsWSS.js";import"./index-CYqyuSLi.js";import"./index-BqJLt5d9.js";import"./index-A8dvgHKY.js";import"./index-BqOjOWET.js";import"./index-DSFQlR52.js";import"./index-Cvc_fY4H.js";import"./createLoading-DlTFYMve.js";import"./debounce-HTNO8IKQ.js";import"./index-BE3-2UW5.js";import"./index-BrX3WsUn.js";import"./index-DCDTgQ2T.js";import"./index-BP2XVsbv.js";/* empty css              */import"./omit-BC7ibGNK.js";import"./request-K5LtYnQH.js";import"./index-yDMkoRSw.js";import"./styleChecker-BBrBaNTm.js";import"./addEventListener-e8APPF7k.js";import"./useDragDropManager-DvbAW2Fo.js";var pe="__lodash_hash_undefined__";function le(r){return this.__data__.set(r,pe),this}function ue(r){return this.__data__.has(r)}function Q(r){var e=-1,t=r==null?0:r.length;for(this.__data__=new Kr;++e<t;)this.add(r[e])}Q.prototype.add=Q.prototype.push=le;Q.prototype.has=ue;function fe(r,e){for(var t=-1,i=r==null?0:r.length;++t<i;)if(e(r[t],t,r))return!0;return!1}function de(r,e){return r.has(e)}var ce=1,me=2;function Or(r,e,t,i,o,a){var l=t&ce,d=r.length,u=e.length;if(d!=u&&!(l&&u>d))return!1;var m=a.get(r),y=a.get(e);if(m&&y)return m==e&&y==r;var h=-1,g=!0,v=t&me?new Q:void 0;for(a.set(r,e),a.set(e,r);++h<d;){var A=r[h],w=e[h];if(i)var P=l?i(w,A,h,e,r,a):i(A,w,h,r,e,a);if(P!==void 0){if(P)continue;g=!1;break}if(v){if(!fe(e,function(E,L){if(!de(v,L)&&(A===E||o(A,E,t,i,a)))return v.push(L)})){g=!1;break}}else if(!(A===w||o(A,w,t,i,a))){g=!1;break}}return a.delete(r),a.delete(e),g}function ge(r){var e=-1,t=Array(r.size);return r.forEach(function(i,o){t[++e]=[o,i]}),t}function ye(r){var e=-1,t=Array(r.size);return r.forEach(function(i){t[++e]=i}),t}var he=1,xe=2,ve="[object Boolean]",Ae="[object Date]",Se="[object Error]",Te="[object Map]",_e="[object Number]",we="[object RegExp]",Pe="[object Set]",Re="[object String]",Oe="[object Symbol]",Ne="[object ArrayBuffer]",Ee="[object DataView]",xr=or?or.prototype:void 0,V=xr?xr.valueOf:void 0;function Le(r,e,t,i,o,a,l){switch(t){case Ee:if(r.byteLength!=e.byteLength||r.byteOffset!=e.byteOffset)return!1;r=r.buffer,e=e.buffer;case Ne:return!(r.byteLength!=e.byteLength||!a(new pr(r),new pr(e)));case ve:case Ae:case _e:return Ur(+r,+e);case Se:return r.name==e.name&&r.message==e.message;case we:case Re:return r==e+"";case Te:var d=ge;case Pe:var u=i&he;if(d||(d=ye),r.size!=e.size&&!u)return!1;var m=l.get(r);if(m)return m==e;i|=xe,l.set(r,e);var y=Or(d(r),d(e),i,o,a,l);return l.delete(r),y;case Oe:if(V)return V.call(r)==V.call(e)}return!1}var De=1,Me=Object.prototype,Ie=Me.hasOwnProperty;function Ce(r,e,t,i,o,a){var l=t&De,d=lr(r),u=d.length,m=lr(e),y=m.length;if(u!=y&&!l)return!1;for(var h=u;h--;){var g=d[h];if(!(l?g in e:Ie.call(e,g)))return!1}var v=a.get(r),A=a.get(e);if(v&&A)return v==e&&A==r;var w=!0;a.set(r,e),a.set(e,r);for(var P=l;++h<u;){g=d[h];var E=r[g],L=e[g];if(i)var B=l?i(L,E,g,e,r,a):i(E,L,g,r,e,a);if(!(B===void 0?E===L||o(E,L,t,i,a):B)){w=!1;break}P||(P=g=="constructor")}if(w&&!P){var b=r.constructor,M=e.constructor;b!=M&&"constructor"in r&&"constructor"in e&&!(typeof b=="function"&&b instanceof b&&typeof M=="function"&&M instanceof M)&&(w=!1)}return a.delete(r),a.delete(e),w}var be=1,vr="[object Arguments]",Ar="[object Array]",H="[object Object]",$e=Object.prototype,Sr=$e.hasOwnProperty;function Fe(r,e,t,i,o,a){var l=J(r),d=J(e),u=l?Ar:ur(r),m=d?Ar:ur(e);u=u==vr?H:u,m=m==vr?H:m;var y=u==H,h=m==H,g=u==m;if(g&&fr(r)){if(!fr(e))return!1;l=!0,y=!1}if(g&&!y)return a||(a=new Y),l||zr(r)?Or(r,e,t,i,o,a):Le(r,e,u,t,i,o,a);if(!(t&be)){var v=y&&Sr.call(r,"__wrapped__"),A=h&&Sr.call(e,"__wrapped__");if(v||A){var w=v?r.value():r,P=A?e.value():e;return a||(a=new Y),o(w,P,t,i,a)}}return g?(a||(a=new Y),Ce(r,e,t,i,o,a)):!1}function tr(r,e,t,i,o){return r===e?!0:r==null||e==null||!k(r)&&!k(e)?r!==r&&e!==e:Fe(r,e,t,i,tr,o)}var Be=1,Ge=2;function Ke(r,e,t,i){var o=t.length,a=o;if(r==null)return!a;for(r=Object(r);o--;){var l=t[o];if(l[2]?l[1]!==r[l[0]]:!(l[0]in r))return!1}for(;++o<a;){l=t[o];var d=l[0],u=r[d],m=l[1];if(l[2]){if(u===void 0&&!(d in r))return!1}else{var y=new Y,h;if(!(h===void 0?tr(m,u,Be|Ge,i,y):h))return!1}}return!0}function Nr(r){return r===r&&!rr(r)}function Ue(r){for(var e=Hr(r),t=e.length;t--;){var i=e[t],o=r[i];e[t]=[i,o,Nr(o)]}return e}function Er(r,e){return function(t){return t==null?!1:t[r]===e&&(e!==void 0||r in Object(t))}}function ze(r){var e=Ue(r);return e.length==1&&e[0][2]?Er(e[0][0],e[0][1]):function(t){return t===r||Ke(t,r,e)}}function He(r,e){return r!=null&&e in Object(r)}function Ye(r,e,t){e=er(e,r);for(var i=-1,o=e.length,a=!1;++i<o;){var l=q(e[i]);if(!(a=r!=null&&t(r,l)))break;r=r[l]}return a||++i!=o?a:(o=r==null?0:r.length,!!o&&Yr(o)&&_r(l,o)&&(J(r)||Jr(r)))}function Je(r,e){return r!=null&&Ye(r,e,He)}var Qe=1,qe=2;function Xe(r,e){return Pr(r)&&Nr(e)?Er(q(r),e):function(t){var i=wr(t,r);return i===void 0&&i===e?Je(t,r):tr(e,i,Qe|qe)}}function Ze(r){return function(e){return e==null?void 0:e[r]}}function je(r){return function(e){return Rr(e,r)}}function We(r){return Pr(r)?Ze(q(r)):je(r)}function Ve(r){return typeof r=="function"?r:r==null?Qr:typeof r=="object"?J(r)?Xe(r[0],r[1]):ze(r):We(r)}var ke="[object Number]";function Tr(r){return typeof r=="number"||k(r)&&qr(r)==ke}function rt(r,e,t,i){if(!rr(r))return r;e=er(e,r);for(var o=-1,a=e.length,l=a-1,d=r;d!=null&&++o<a;){var u=q(e[o]),m=t;if(u==="__proto__"||u==="constructor"||u==="prototype")return r;if(o!=l){var y=d[u];m=void 0,m===void 0&&(m=rr(y)?y:_r(e[o+1])?[]:{})}Xr(d,u,m),d=d[u]}return r}function et(r,e,t){for(var i=-1,o=e.length,a={};++i<o;){var l=e[i],d=Rr(r,l);t(d,l)&&rt(a,er(l,r),d)}return a}function tt(r,e){if(r==null)return{};var t=ae(Zr(r),function(i){return[i]});return e=Ve(e),et(r,t,function(i,o){return e(i,o[0])})}const nt=({id:r,type:e,config:t,elements:i,onCheckedChange:o},a)=>{var nr,ir,ar;const[l,d]=T.useState({}),[u,m]=T.useState({[t.props.field.pageNum]:1,[t.props.field.pageSize]:t.props.pagination.pageSize}),[y,h]=T.useState([]),[g,v]=T.useState(!1),[A,w]=T.useState(0),[P,E]=T.useState([]),[L,B]=T.useState([]),[b,M]=T.useState(!0),{mode:Lr,addChildElements:Dr,variableData:Mr,updateToolbar:Ir}=jr(p=>({mode:p.mode,addChildElements:p.addChildElements,variableData:p.page.pageData.variableData,updateToolbar:p.updateToolbar}));T.useEffect(()=>{const p={[t.props.field.pageNum]:1,[t.props.field.pageSize]:t.props.pagination.pageSize};m(p),G(t.props.hidePager?{}:p)},[t.api,t.props.pagination.pageSize,JSON.stringify(t.props.field),((nr=t.api)==null?void 0:nr.sourceType)=="variable"?Mr:""]);const G=T.useCallback(p=>{v(!0),ie(t.api,p).then(n=>{v(!1),Ir(),(n==null?void 0:n.code)===0&&(Array.isArray(n.data)&&h(n.data),t.props.field.total&&w(wr(n.originData,t.props.field.total)||0))}).catch(()=>{v(!1)})},[t.api]),[,Cr]=oe({accept:"MENU_ITEM",async drop(p,n){var x;if(n.didDrop())return;const{config:S,events:D,methods:N=[]}=((x=await te(p.type+"Config"))==null?void 0:x.default)||{};Dr({type:p.type,name:p.name,parentId:r,id:p.id,config:S,events:D,methods:N})},collect:p=>({isOver:p.isOver(),canDrop:p.canDrop()})});T.useImperativeHandle(a,()=>({startLoading:()=>{v(!0)},stopLoading:()=>{v(!1)},show(){M(!0)},hide(){M(!1)},search:p=>{const n=tt(p,S=>mr(S));m({...u,[t.props.field.pageNum]:1}),d(n),G({...u,[t.props.field.pageNum]:1,...n})},reload:()=>{G({...u,...l})},clearData:()=>{h([])},checkSelectedRow:()=>P.length!==0,setSelectedRowKeys:p=>{E(p)},getSelectedRowKeys:()=>({selectedRowKeys:P||[]}),getSelectedRow:()=>L}));const br=T.useMemo(()=>{let p={};return t.props.selectionType?p={type:t.props.selectionType,selectedRowKeys:P,onChange(n,S){o==null||o({selectedRowKeys:n}),E(n),B(S)}}:p=null,{rowSelection:p,...t.props,rowKey:t.props.rowKey||"id",columns:t.props.columns.map((n,S)=>{const D=n.dataIndex||"-"+S;return{...n,dataIndex:D,key:D,onCell(N,x){if(n.onCell)try{return new Function("record","index",`return (${n.onCell})(record,index);`)(N,x)}catch(I){console.error(`列[${n.title}]渲染失败`,I)}return{}},render(N,x,I){var C,F;let s=N;try{if(mr(s)?n.type==="money"?s=gr(N,"currency"):n.type==="number"?s=gr(N):n.type==="date1"?s=yr(N,"YYYY-MM-DD"):n.type==="date2"&&(s=yr(N)):typeof t.props.empty>"u"?s="-":t.props.empty&&(s=t.props.empty),n.render)try{s=new Function("text","record","index",`return (${n.render})(text,record,index);`)(s,x,I)}catch(c){console.error(`列[${n.title}]渲染失败`,c),s="解析异常"}if(n.type==="text"){const c=f.jsx(U,{type:"link",onClick:()=>X(n.eventName,x),children:s.toString()});return n.ellipsis&&n.copyable?f.jsx(dr,{title:s,children:f.jsx(hr.Paragraph,{copyable:!0,style:{marginBottom:0},children:n.clickable?c:s.toString()})}):n.ellipsis?f.jsx(dr,{title:s,children:n.clickable?c:s.toString()}):n.copyable?f.jsx(hr.Paragraph,{copyable:!0,children:n.clickable?c:s.toString()}):n.clickable?f.jsx(U,{type:"link",onClick:()=>X(n.eventName,x),children:s.toString()}):s.toString()}if(n.type==="multiline")return Array.isArray(s)?s.map((c,R)=>f.jsxs("div",{children:[f.jsx("span",{children:c.label}),f.jsx("span",{children:c.value})]},R)):s.toString();if(n.type==="status")return Array.isArray(s)?s.map((c,R)=>f.jsx(Z,{status:c.status,text:c.text},R)):typeof s=="object"?f.jsx(Z,{status:s.status,text:s.text}):f.jsx(Z,{status:"success",text:s.toString()});if(n.type==="image"){const{width:c=30,height:R=30}=(n==null?void 0:n.imageConfig)||{};if(Array.isArray(s)){const O=$=>Tr(Number($))?Number($):$;return f.jsx(j.PreviewGroup,{items:s,children:f.jsx(j,{width:O(c),height:O(R),src:s[0]})})}const _=O=>Tr(Number(O))?Number(O):O;return((C=s==null?void 0:s.startsWith)==null?void 0:C.call(s,"http"))&&f.jsx(j,{src:s,width:_(c),height:_(R)})||s}if(n.type==="tag")return Array.isArray(s)?s.map((c,R)=>typeof c=="object"?f.jsx(W,{color:c.color,children:c.label},R):f.jsx(W,{color:"green",children:c},c)):typeof s=="string"||typeof s=="number"?f.jsx(W,{color:"green",children:s}):s==null?void 0:s.toString();if(n.type==="action"){const{moreActionIndex:c}=n,R=(F=n.list)==null?void 0:F.map(_=>{var $;let O="";if(typeof _.text=="string")O=_.text;else if((($=_.text)==null?void 0:$.type)==="static")O=_.text.value;else try{O=new Function("text","record","index",`return (${_.text.value})(text,record,index);`)("",x,I)}catch(sr){console.error(`列[${_.title}]渲染失败`,sr),O="解析异常"}if(O!=="")return f.jsx(U,{type:"link",size:"small",danger:_.danger,onClick:()=>X(_.eventName,x),children:O},_.eventName)});if(c&&R.slice(c-1).length){const _=f.jsx("div",{style:{display:"flex",flexDirection:"column"},children:R.slice(c-1)});return f.jsxs("div",{className:z.action,children:[R.slice(0,c-1),f.jsx(Wr,{trigger:"click",content:_,children:f.jsx(Vr,{})})]})}return f.jsx(kr,{children:R})}return s}catch(c){return console.error(`列[${n.title}]渲染失败`,c),t.props.empty||"-"}}}}),dataSource:y,loading:g}},[t.props,y,g,P]),$r=T.useMemo(()=>{const{pageNum:p="pageNum",pageSize:n="pageSize"}=t.props.field||{},{showSizeChanger:S,showQuickJumper:D,showTotal:N,pageSize:x,position:I}=t.props.pagination||{},s=x?[x,x*2,x*3,x*4]:[10,20,30,40];return{total:A,current:u[p]||1,pageSize:u[n]||10,pageSizeOptions:s,showSizeChanger:S,showQuickJumper:D,showTotal:N?C=>`共 ${C} 条数据`:void 0,position:I,onChange:(C,F)=>{m({[p]:C,[n]:F}),G({[p]:C,[n]:F,...l})}}},[A,t.props.field,u,t.props.pagination]),Fr=p=>{const n=t.events.find(S=>S.eventName===p);cr(n==null?void 0:n.actions,l)},X=(p,n)=>{const S=t.events.find(D=>D.eventName===p);cr(S==null?void 0:S.actions,n)},Br=t.props.leftTitle,K=t.props.bulkActionList||[],Gr=ee;return b&&f.jsxs("div",{"data-id":r,"data-type":e,style:t.style,children:[Br||i!=null&&i.length||K.length?f.jsxs("div",{className:z.toolbar,children:[t.props.leftTitle&&f.jsx("div",{className:z.title,children:t.props.leftTitle}),f.jsxs("div",{className:z.action,ref:Cr,children:[i!=null&&i.length?f.jsx(ne,{elements:i}):Lr==="edit"?f.jsx("div",{className:"slots",children:"拖拽子元素到这里，可以考虑嵌套一个搜索表单"}):null,K==null?void 0:K.map(p=>f.jsx(U,{type:p.type,danger:p.danger,icon:p.icon?re.createElement(Gr[p.icon]):null,onClick:()=>Fr(p.eventName),children:p.text},p.eventName))]})]}):null,f.jsx(se,{...br,scroll:{x:(ir=t.props.scroll)==null?void 0:ir.x,y:(ar=t.props.scroll)==null?void 0:ar.y},pagination:t.props.hidePager?!1:$r})]})},ii=T.memo(T.forwardRef(nt));export{ii as default};
