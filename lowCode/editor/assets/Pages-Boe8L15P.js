import{r as u,e as w,j as e,T as c,R as S,u as b,m as R,f as y,M as I,d as C,b as T,c as k,S as $,B as N}from"./index-DmOc0qNU.js";import{s as d,u as E,a as z,S as F}from"./index.module-BXHNkgSa.js";import{C as B}from"./CreatePage-unumot6h.js";import{T as j}from"./index-DFI99UhQ.js";import{R as g,a as x}from"./ExclamationCircleOutlined-DHCAK7Yp.js";import{C as L}from"./index-PKq6ibgt.js";import{R as A}from"./EyeOutlined-QFSiY36E.js";import{R as D}from"./CopyOutlined-BRIAy90h.js";import{R as G}from"./DeleteOutlined-BnUSKaGo.js";import{R as M}from"./RedoOutlined-C4rr1ZME.js";import{R as U}from"./UserOutlined-DAUrDjKa.js";import{I as _}from"./index-jIBCjwxt.js";import{F as q}from"./index-1_6nT-oA.js";import{E as O}from"./index-wVmnK_0F.js";import{R as Q}from"./PlusOutlined-BSTEPWl7.js";import{P as V}from"./Pagination-B_kLQQfV.js";import"./debounce-CoSCf5Zb.js";import"./index-El1GW9WO.js";import"./isBrowser-CCWS3Xh9.js";import"./index-B-YUPJxN.js";import"./index-DOHCQObp.js";import"./BaseInput-4F0kfgVN.js";import"./TextArea-D7VuO_-I.js";import"./useVariants-BdxfBOl3.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./SearchOutlined-DscCkqW9.js";import"./project-RurpUGJo.js";import"./index-_pMv_sKm.js";import"./index-DSaINUG7.js";import"./useShowArrow-CIjY5B73.js";import"./List-BV6fBbjc.js";import"./useIcons-CLAJNkrF.js";import"./DownOutlined-DnWdyoG8.js";import"./index-Dg1x3Ybx.js";import"./addEventListener-CKCD8Vpz.js";import"./ZoomOutOutlined-IpS0JADO.js";import"./row-pIc0FM19.js";import"./QuestionCircleOutlined-Dza1yYuv.js";import"./DoubleRightOutlined-FRvrxn3q.js";import"./useBreakpoint-Dj2PHoq7.js";import"./useForceUpdate-Y5LXbfsE.js";const W=({item:o})=>{const{pathname:l}=w();if(o.stgState===1&&o.preState===1&&o.prdState===1)return e.jsx(j,{children:e.jsx(c,{title:"待开发",children:"NEW"})});let n={color:"",icon:e.jsx(g,{}),tooltip:"已发布"},a={color:"",icon:e.jsx(g,{}),tooltip:"已发布"},i={color:"",icon:e.jsx(g,{}),tooltip:"已发布"};return o.stgState===4?n={color:"red",icon:e.jsx(x,{}),tooltip:"版本已回滚"}:o.stgState===3?n={color:"success",icon:e.jsx(g,{}),tooltip:"版本已发布"}:o.stgState===2&&o.stgPublishId?n={color:"warning",icon:e.jsx(x,{}),tooltip:"版本已落后"}:n={color:"",icon:e.jsx(S,{}),tooltip:"版本未发布"},o.preState===4?a={color:"red",icon:e.jsx(x,{}),tooltip:"版本已回滚"}:o.preState===3?a={color:"success",icon:e.jsx(g,{}),tooltip:"版本已发布"}:o.preState===2&&o.prePublishId?a={color:"warning",icon:e.jsx(x,{}),tooltip:"版本已落后"}:a={color:"",icon:e.jsx(S,{}),tooltip:"版本未发布"},o.prdState===4?i={color:"red",icon:e.jsx(x,{}),tooltip:"版本已回滚"}:o.prdState===3?i={color:"success",icon:e.jsx(g,{}),tooltip:"版本已发布"}:o.prdState===2&&o.prdPublishId?i={color:"warning",icon:e.jsx(x,{}),tooltip:"版本已落后"}:i={color:"",icon:e.jsx(S,{}),tooltip:"版本未发布"},e.jsxs(e.Fragment,{children:[e.jsx(c,{title:n.tooltip,children:e.jsx("a",{href:`http://localhost:8090/page/${o.id}?env=stg`,target:"_blank",children:e.jsx(j,{color:n.color,icon:n.icon,bordered:!1,onClick:s=>s.stopPropagation(),children:"STG"})})}),l==="/templates"?null:e.jsxs(e.Fragment,{children:[e.jsx(c,{title:a.tooltip,children:e.jsx("a",{href:`http://localhost:8090/page/${o.id}?env=pre`,target:"_blank",children:e.jsx(j,{color:a.color,icon:a.icon,bordered:!1,onClick:s=>s.stopPropagation(),children:"PRE"})})}),e.jsx(c,{title:i.tooltip,children:e.jsx("a",{href:`http://localhost:8090/page/${o.id}?env=prd`,target:"_blank",children:e.jsx(j,{color:i.color,icon:i.icon,bordered:!1,onClick:s=>s.stopPropagation(),children:"PRD"})})})]})]})},X=u.memo(W),H=({list:o,copy:l,refresh:n})=>{const[a,i]=u.useState(!1),[s,f]=u.useState(""),m=b(),p=async(t,r)=>{if(t==="preview"){if(!r.previewImg)return R.warning("该页面未生成预览图");i(!0),f(r.previewImg);return}if(t==="edit")return m(`/editor/${r==null?void 0:r.id}/edit`);if(t==="copy")return l==null?void 0:l(r);t==="delete"&&I.confirm({title:"确认",content:"删除后，该页面无法恢复，请谨慎操作。",okText:"确认",okButtonProps:{danger:!0},cancelText:"取消",onOk:async()=>{await C.delPageData({id:r.id}),R.success("删除成功"),n()}})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(320px, 1fr))",gap:20},children:o.map((t,r)=>e.jsx(L,{actions:[e.jsx(c,{title:"预览",children:e.jsx(A,{style:{fontSize:16},onClick:()=>p("preview",t)})}),e.jsx(c,{title:"复制",children:e.jsx(D,{style:{fontSize:16},onClick:()=>p("copy",t)})}),e.jsx(c,{title:"删除",children:e.jsx(G,{style:{fontSize:16},onClick:()=>p("delete",t)})}),e.jsx(c,{title:"访问STG",children:e.jsx(M,{style:{fontSize:16},onClick:()=>{R.warning("请移步官网查看")}})})],children:e.jsxs("div",{className:d.cardBody,onClick:()=>p("edit",t),children:[e.jsx("div",{className:d.itemEnv,children:e.jsx(X,{item:t})}),e.jsx("div",{className:d.itemTitle,children:t.name}),e.jsx("div",{className:d.itemRemark,children:t.remark||"暂无描述"}),e.jsxs("div",{className:d.updateUser,children:[e.jsxs("span",{style:{marginRight:10},children:[e.jsx(U,{style:{fontSize:15,marginRight:5}}),e.jsx("span",{children:t.userName})]}),e.jsxs("span",{children:["更新于 ",y(t.updatedAt).fromNow()]})]})]})},t.id||t.userName+r))}),e.jsx(_,{style:{display:"none"},preview:{visible:a,src:s,onVisibleChange:t=>{i(t),f("")}}})]})};function Ae(){const[o]=q.useForm(),l=u.useRef(),[n]=T(),a=E({query:"(min-width: 1920px)"}),i=({current:r,pageSize:h},{keyword:P})=>C.getPageList({pageNum:r,pageSize:h,keyword:P,projectId:Number(n.get("projectId"))}).then(v=>({total:v.total,list:v.list})),{tableProps:s,loading:f,search:m}=z(i,{form:o,defaultPageSize:a?15:12}),p=()=>{var r;(r=l.current)==null||r.open("create")},t=r=>{var h;(h=l.current)==null||h.open("copy",r)};return e.jsx(e.Fragment,{children:e.jsxs(k.Content,{className:d.pageList,children:[e.jsx(F,{showGroup:!1,form:o,from:"页面",submit:m.submit,refresh:m.submit,onCreate:p}),e.jsx("div",{className:d.pagesContent,children:e.jsx($,{spinning:f,size:"large",tip:"加载中...",children:s.dataSource.length>0?e.jsx(H,{list:s.dataSource,copy:t,refresh:m.submit}):e.jsx(O,{style:{marginTop:100},children:e.jsx(N,{type:"dashed",icon:e.jsx(Q,{}),onClick:p,children:"创建页面"})})})}),s.dataSource.length>0?e.jsx(V,{...s.pagination,onChange:(r,h)=>s.onChange({current:r,pageSize:h}),showSizeChanger:!0,showTotal:r=>`总共 ${r} 条`,align:"end"}):null,e.jsx(B,{createRef:l,update:m.submit})]})})}export{Ae as default};
