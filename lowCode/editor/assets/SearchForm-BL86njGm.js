import{r as a,a as z,f as G,j as r,i as J,B as u,k as K}from"./index-DmOc0qNU.js";import{g as Q}from"./index-D_sh-7v0.js";import{M as X}from"./MarsRender-CU_k9oCt.js";import{i as Y}from"./index-C3QLbPSd.js";import{FormContext as Z}from"./context-CwFBKCg9.js";import{d as c,i as tt,b as ot,e as rt}from"./util-DNkFm-j2.js";import{handleActionFlow as it}from"./action-CbrbshM_.js";import k from"./index.module-CQaTMcB5.js";import{F as E}from"./index-1_6nT-oA.js";import{R as et}from"./SearchOutlined-DscCkqW9.js";import{b as st}from"./RedoOutlined-C4rr1ZME.js";import{R as pt}from"./UpOutlined-CkYvBYD1.js";import{R as mt}from"./DownOutlined-DnWdyoG8.js";import{u as at}from"./useDrop-BKAPRNi5.js";import"./useComponentRefs-BjsmN1lJ.js";import"./shallow-DkvW6rgF.js";import"./SoundOutlined-C2LYByLL.js";import"./index-CcJLco_Z.js";import"./scrollTo-D0zr6O2z.js";import"./index-DSaINUG7.js";import"./useShowArrow-CIjY5B73.js";import"./List-BV6fBbjc.js";import"./index-wVmnK_0F.js";import"./useIcons-CLAJNkrF.js";import"./useVariants-BdxfBOl3.js";import"./index-Df3uJrKd.js";import"./row-pIc0FM19.js";import"./useBreakpoint-Dj2PHoq7.js";import"./useForceUpdate-Y5LXbfsE.js";import"./index-BIB-vVSn.js";import"./SwapRightOutlined-l_ApuJtI.js";import"./index-DOHCQObp.js";import"./index-DxJl0Bxc.js";import"./index-B5-G8EA2.js";import"./index-PKq6ibgt.js";import"./index-Dg1x3Ybx.js";import"./PlusOutlined-BSTEPWl7.js";import"./index-DfZhUM4Q.js";import"./conductUtil-wNhCxpcs.js";import"./index-B2mTmS5H.js";import"./index-Bp74baIv.js";import"./ColorPicker-CHwPjknD.js";import"./index-Do4qj9dd.js";import"./index-eEpHjpWF.js";import"./index-o7l-rjNw.js";import"./BaseInput-4F0kfgVN.js";import"./index-B-YUPJxN.js";import"./TextArea-D7VuO_-I.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./EyeOutlined-QFSiY36E.js";import"./index-C-pH6dK5.js";import"./index-DIJm4IIM.js";import"./index-jIBCjwxt.js";import"./addEventListener-CKCD8Vpz.js";import"./ZoomOutOutlined-IpS0JADO.js";import"./index-CW6BFuNZ.js";import"./extendsObject-keMuGWqj.js";import"./Pagination-B_kLQQfV.js";import"./DoubleRightOutlined-FRvrxn3q.js";import"./index-BytaExX6.js";import"./EditOutlined-D6nYSc60.js";import"./styleChecker-CQ-R2cXJ.js";import"./EnterOutlined-D0ebLqDC.js";import"./index-C0E5Fhz-.js";import"./CopyOutlined-BRIAy90h.js";import"./index-_pMv_sKm.js";import"./index-CAhQjzfH.js";import"./index-B6d_3ZHh.js";import"./PlusSquareOutlined-D0i2U-a9.js";import"./FolderOpenOutlined-Bj6jPccg.js";import"./HolderOutlined-CzOeoeCY.js";import"./index-DBzmE0wc.js";import"./index-zUAcsxVR.js";import"./WarningFilled-DrN-C8wT.js";import"./index-9ch0MKpQ.js";import"./index-DFI99UhQ.js";import"./index-KkE6TN4K.js";import"./Table-ChTYBmDg.js";import"./FilterFilled-BYB9ZItm.js";import"./CaretDownOutlined-Cvfi80LL.js";import"./DeleteOutlined-BnUSKaGo.js";import"./createLoading-4QOu0SEw.js";import"./debounce-CoSCf5Zb.js";import"./index-Dbrwdd6Z.js";import"./index-BUKMMZAh.js";import"./index-BmnSvrnD.js";import"./index-DYQX7UPG.js";/* empty css              */import"./omit-K9EDc_4o.js";import"./_baseGet-xRkAGEE7.js";import"./AlignRightOutlined-Kg291cY_.js";import"./UsergroupAddOutlined-Bx2neJ9_.js";import"./ExclamationCircleOutlined-DHCAK7Yp.js";import"./MoreOutlined-C8o90ux3.js";import"./FunctionOutlined-Dm0pzJNb.js";import"./InfoCircleOutlined-D9lj3ic_.js";import"./TeamOutlined-B9XPKo8Z.js";import"./NotificationOutlined-DlRBMYlM.js";import"./MinusOutlined-Cj88Lgeh.js";import"./QuestionCircleOutlined-Dza1yYuv.js";import"./SaveOutlined-Da_V74JD.js";import"./SettingOutlined-CGW_ik-t.js";import"./SyncOutlined-D_H3wSeZ.js";import"./LockOutlined-COu0XHB3.js";import"./UserOutlined-DAUrDjKa.js";import"./handleApi-CJLwph67.js";import"./request-C0MTnMVW.js";import"./useDragDropManager-Dl0-aEZk.js";const nt=({id:p,type:I,config:n,elements:m,onSearch:x,onChange:f,onReset:g},T)=>{var R;const[s]=E.useForm(),y=a.useRef(null),[d,C]=a.useState(!1),[N,v]=a.useState(!1),[S,F]=a.useState(!0),[M,w]=a.useState({}),{addChildElements:A,updateToolbar:L,formData:j,setFormData:l}=z(t=>({addChildElements:t.addChildElements,updateToolbar:t.updateToolbar,formData:t.page.pageData.formData,setFormData:t.setFormData}));a.useEffect(()=>{setTimeout(()=>{var t;((t=y.current)==null?void 0:t.offsetTop)>=32&&m.length>0?v(!0):v(!1)},500)},[m]);const[,P]=at({accept:"MENU_ITEM",async drop(t,o){var V;if(o.didDrop())return;const{config:i,events:e,methods:h=[]}=((V=await Q(t.type+"Config"))==null?void 0:V.default)||{};A({type:t.type,name:t.name,parentId:p,id:t.id,config:i,events:e,methods:h})},collect:t=>({isOver:t.isOver(),canDrop:t.canDrop()})}),$=()=>{const t=s.getFieldsValue();x&&x(c(m,t))},B=()=>{s.resetFields();const t=s.getFieldsValue();g&&g(c(m,t)),l({name:p,value:t,type:"override"})},H=(t,o)=>{const i=c(m,o);f==null||f(i),l({name:p,value:i})};a.useImperativeHandle(T,()=>({show(){F(!0)},hide(){F(!1)},reset(){s.resetFields(),l({name:p,value:s.getFieldsValue(),type:"override"})},submit(){s.submit()},init(t={}){const o=c(m,t);s.setFieldsValue(o),l({name:p,value:o,type:"override"})},getFormData(t){var o;return t&&typeof t=="string"?(o=j[p])==null?void 0:o[t]:j[p]}}));const O=t=>{const o=s.getFieldsValue(),i=c(m,o),e=n.events.find(h=>h.eventName===t);it(e==null?void 0:e.actions,i)},_=()=>{C(!d),L()},{submitText:b,resetText:D}=n.props.form||{},U=n.props.bulkActionList||[],W=a.useCallback((t,o,i)=>{if(o&&tt(i)){let e=i;t==="InputNumber"&&(e=Number(i)),t==="DatePicker"&&(e=ot(i)),t==="DatePickerRange"&&(e=rt(i)),t==="TimePicker"&&(e=G(i,"HH:mm:ss")),w({[o]:e}),s.setFieldValue([o],e),l({name:p,value:{[o]:e}})}},[]),q=Y;return S&&r.jsx(Z.Provider,{value:{initValues:W},children:r.jsxs(E,{form:s,layout:"inline",style:n.style,"data-id":p,"data-type":I,initialValues:M,onValuesChange:H,children:[r.jsxs("div",{className:k.formWrap,ref:P,style:d?{}:{height:32,overflow:"hidden"},children:[m.length?r.jsx(X,{elements:m}):r.jsx("div",{className:"slots",children:"拖拽表单组件到这里"}),r.jsx("div",{ref:y})]}),r.jsxs(J,{style:{alignItems:"baseline",marginLeft:10},children:[b?r.jsx(u,{type:"primary",icon:r.jsx(et,{}),onClick:$,children:b}):null,D?r.jsx(u,{type:"default",icon:r.jsx(st,{}),onClick:B,children:D}):null,U.length>0&&r.jsx("div",{className:k.action,children:(R=n.props.bulkActionList)==null?void 0:R.map((t,o)=>r.jsx(u,{type:t.type,danger:t.danger,icon:t.icon?K.createElement(q[t.icon]):null,onClick:()=>O(t.eventName),children:t.text},`bulkAction${o}`))}),N&&r.jsx(u,{type:"link",icon:d?r.jsx(pt,{}):r.jsx(mt,{}),onClick:_,children:d?"收起":"展开"})]})]})})},cr=a.forwardRef(nt);export{cr as default};
