import{r as a,a as z,f as G,j as r,i as J,B as u,k as K}from"./index-CY1Ymj4r.js";import{g as Q}from"./index-Bkuj5IWs.js";import{M as X}from"./MarsRender-B9LyhaO3.js";import{i as Y}from"./index-C4qQ40vK.js";import{FormContext as Z}from"./context-lPMLs1NY.js";import{d as c,i as tt,b as ot,e as rt}from"./util-UBnOudtO.js";import{handleActionFlow as it}from"./action-BWjACvR_.js";import k from"./index.module-CQaTMcB5.js";import{F as E}from"./index-BKDg-K48.js";import{R as et}from"./SearchOutlined-DZ2l1XJ5.js";import{b as st}from"./RedoOutlined-CJagRpK4.js";import{R as pt}from"./UpOutlined-Bu3BOxje.js";import{R as mt}from"./DownOutlined-QYs-kCMH.js";import{u as at}from"./useDrop-D9SfugPi.js";import"./useComponentRefs-BjsmN1lJ.js";import"./shallow-Bi0WipZC.js";import"./SoundOutlined-B7v31N9V.js";import"./index-B0UeyOoa.js";import"./scrollTo-hj5AlJ0c.js";import"./index-CUKOry-Y.js";import"./useShowArrow-C9phI0pM.js";import"./List-CfIaGhIa.js";import"./index-DYezmHfp.js";import"./useIcons-CYuILU2n.js";import"./useVariants-B4R8rkTL.js";import"./index-BC5zvAmk.js";import"./row-C5ps4gU6.js";import"./useBreakpoint-D-Sgac-T.js";import"./useForceUpdate-BsEHW89a.js";import"./index-DOjNdDXR.js";import"./SwapRightOutlined-CcIdOt_e.js";import"./index-C1u3Ql-g.js";import"./index-CrCWvzoA.js";import"./index-CVwKh-ii.js";import"./index-DBtJBM7q.js";import"./index-Tz3gITLY.js";import"./PlusOutlined-dRNvmZ2Y.js";import"./index-CksWDIx9.js";import"./conductUtil-oPofkrzY.js";import"./index-CMyR3-Rp.js";import"./index-B5fUo_Hm.js";import"./ColorPicker-CHT1xIcH.js";import"./index-CQwwCPyp.js";import"./index-jYDJ93V_.js";import"./index-BnlvMKaU.js";import"./BaseInput-Bka7TPzR.js";import"./index-Du8QL6nv.js";import"./TextArea-U5uDgpR6.js";import"./EyeInvisibleOutlined-DDX5Jvzv.js";import"./EyeOutlined-B6CobvGR.js";import"./index-DQZxJH5O.js";import"./index-Sy3WWpq7.js";import"./index-BH8xWKmO.js";import"./addEventListener-e8APPF7k.js";import"./ZoomOutOutlined-t4Key8LE.js";import"./index-BX8mFvI3.js";import"./extendsObject-keMuGWqj.js";import"./Pagination-BhehRHa0.js";import"./DoubleRightOutlined-BcWxf5hS.js";import"./index-ELXMiYH9.js";import"./EditOutlined-JZ6BD8WC.js";import"./styleChecker-BBrBaNTm.js";import"./EnterOutlined-DS0cowoX.js";import"./index-yDMkoRSw.js";import"./CopyOutlined-CQbFHu9s.js";import"./index-ClLmsWSS.js";import"./index-CYqyuSLi.js";import"./index-BqJLt5d9.js";import"./PlusSquareOutlined-D3cnUxWk.js";import"./FolderOpenOutlined-CDyAvlLT.js";import"./HolderOutlined-E1hrqN51.js";import"./index-A8dvgHKY.js";import"./index-BqOjOWET.js";import"./WarningFilled-k-vsk_P7.js";import"./index-DSFQlR52.js";import"./index-BcUfWEv4.js";import"./index-Cvc_fY4H.js";import"./Table-DKwxKTfy.js";import"./FilterFilled-S1ql0Sss.js";import"./CaretDownOutlined-fvgXmNbc.js";import"./DeleteOutlined-BfdCKHnO.js";import"./createLoading-DlTFYMve.js";import"./debounce-HTNO8IKQ.js";import"./index-BE3-2UW5.js";import"./index-BrX3WsUn.js";import"./index-DCDTgQ2T.js";import"./index-BP2XVsbv.js";/* empty css              */import"./omit-BC7ibGNK.js";import"./_baseGet-C1wBFXxd.js";import"./AlignRightOutlined-BaOygGam.js";import"./UsergroupAddOutlined-DQ7Kwpsy.js";import"./ExclamationCircleOutlined-CkY-Dzll.js";import"./MoreOutlined-BHx2P-s-.js";import"./FunctionOutlined-D3UO96Yh.js";import"./InfoCircleOutlined-DWZ7nUzE.js";import"./TeamOutlined-BmFXVwN3.js";import"./NotificationOutlined-C3CDmrw2.js";import"./MinusOutlined-CsSa3QgW.js";import"./QuestionCircleOutlined-TTJW15q1.js";import"./SaveOutlined-CRp1-oFH.js";import"./SettingOutlined-B7WTL30f.js";import"./SyncOutlined-SA527A4F.js";import"./LockOutlined-Bzfo-a2y.js";import"./UserOutlined-CjZcwOl4.js";import"./handleApi-Bz3x1xZ4.js";import"./request-K5LtYnQH.js";import"./useDragDropManager-DvbAW2Fo.js";const nt=({id:p,type:I,config:n,elements:m,onSearch:x,onChange:f,onReset:g},T)=>{var R;const[s]=E.useForm(),y=a.useRef(null),[d,C]=a.useState(!1),[N,v]=a.useState(!1),[S,F]=a.useState(!0),[M,w]=a.useState({}),{addChildElements:A,updateToolbar:L,formData:j,setFormData:l}=z(t=>({addChildElements:t.addChildElements,updateToolbar:t.updateToolbar,formData:t.page.pageData.formData,setFormData:t.setFormData}));a.useEffect(()=>{setTimeout(()=>{var t;((t=y.current)==null?void 0:t.offsetTop)>=32&&m.length>0?v(!0):v(!1)},500)},[m]);const[,P]=at({accept:"MENU_ITEM",async drop(t,o){var V;if(o.didDrop())return;const{config:i,events:e,methods:h=[]}=((V=await Q(t.type+"Config"))==null?void 0:V.default)||{};A({type:t.type,name:t.name,parentId:p,id:t.id,config:i,events:e,methods:h})},collect:t=>({isOver:t.isOver(),canDrop:t.canDrop()})}),$=()=>{const t=s.getFieldsValue();x&&x(c(m,t))},B=()=>{s.resetFields();const t=s.getFieldsValue();g&&g(c(m,t)),l({name:p,value:t,type:"override"})},H=(t,o)=>{const i=c(m,o);f==null||f(i),l({name:p,value:i})};a.useImperativeHandle(T,()=>({show(){F(!0)},hide(){F(!1)},reset(){s.resetFields(),l({name:p,value:s.getFieldsValue(),type:"override"})},submit(){s.submit()},init(t={}){const o=c(m,t);s.setFieldsValue(o),l({name:p,value:o,type:"override"})},getFormData(t){var o;return t&&typeof t=="string"?(o=j[p])==null?void 0:o[t]:j[p]}}));const O=t=>{const o=s.getFieldsValue(),i=c(m,o),e=n.events.find(h=>h.eventName===t);it(e==null?void 0:e.actions,i)},_=()=>{C(!d),L()},{submitText:b,resetText:D}=n.props.form||{},U=n.props.bulkActionList||[],W=a.useCallback((t,o,i)=>{if(o&&tt(i)){let e=i;t==="InputNumber"&&(e=Number(i)),t==="DatePicker"&&(e=ot(i)),t==="DatePickerRange"&&(e=rt(i)),t==="TimePicker"&&(e=G(i,"HH:mm:ss")),w({[o]:e}),s.setFieldValue([o],e),l({name:p,value:{[o]:e}})}},[]),q=Y;return S&&r.jsx(Z.Provider,{value:{initValues:W},children:r.jsxs(E,{form:s,layout:"inline",style:n.style,"data-id":p,"data-type":I,initialValues:M,onValuesChange:H,children:[r.jsxs("div",{className:k.formWrap,ref:P,style:d?{}:{height:32,overflow:"hidden"},children:[m.length?r.jsx(X,{elements:m}):r.jsx("div",{className:"slots",children:"拖拽表单组件到这里"}),r.jsx("div",{ref:y})]}),r.jsxs(J,{style:{alignItems:"baseline",marginLeft:10},children:[b?r.jsx(u,{type:"primary",icon:r.jsx(et,{}),onClick:$,children:b}):null,D?r.jsx(u,{type:"default",icon:r.jsx(st,{}),onClick:B,children:D}):null,U.length>0&&r.jsx("div",{className:k.action,children:(R=n.props.bulkActionList)==null?void 0:R.map((t,o)=>r.jsx(u,{type:t.type,danger:t.danger,icon:t.icon?K.createElement(q[t.icon]):null,onClick:()=>O(t.eventName),children:t.text},`bulkAction${o}`))}),N&&r.jsx(u,{type:"link",icon:d?r.jsx(pt,{}):r.jsx(mt,{}),onClick:_,children:d?"收起":"展开"})]})]})})},cr=a.forwardRef(nt);export{cr as default};
