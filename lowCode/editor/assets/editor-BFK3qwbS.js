import{r as c,h as ke,a as U,A as re,j as t,i as V,T as O,B as M,E as de,d as Y,F as _e,G as Ie,P as Se,s as H,H as be,u as Pe,I as Re,m as G,y as Ne,J as De,k as Le,K as ne,N as K,Q as Me}from"./index-DmOc0qNU.js";import{u as Te}from"./index-CrdplzP2.js";import{u as $e,h as oe,j as Z}from"./debounce-CoSCf5Zb.js";import{i as Be,a as pe,d as ae,b as Oe,c as fe}from"./isBrowser-CCWS3Xh9.js";import{g as ie}from"./index-D_sh-7v0.js";import{R as ze,a as We,b as Ae,c as qe}from"./index-C3QLbPSd.js";import{R as ue}from"./CopyOutlined-BRIAy90h.js";import{R as me}from"./DeleteOutlined-BnUSKaGo.js";import Ue from"./Page-BJpKWTAB.js";import se from"./Schema-exDjRayd.js";import{getComponentRef as Ke}from"./useComponentRefs-BjsmN1lJ.js";import{B as ce,c as he}from"./SoundOutlined-C2LYByLL.js";import{C as Ve}from"./CreatePage-unumot6h.js";import{c as He}from"./index-C0E5Fhz-.js";import{I as Je}from"./index-B-YUPJxN.js";import{A as Ge}from"./index-Df3uJrKd.js";import{R as Qe}from"./UserOutlined-DAUrDjKa.js";import{Q as Xe}from"./MarsRender-CU_k9oCt.js";import{S as Ze}from"./index-DSaINUG7.js";import{R as Fe}from"./SettingOutlined-CGW_ik-t.js";import{R as Ye}from"./SaveOutlined-Da_V74JD.js";import{R as et}from"./EyeOutlined-QFSiY36E.js";import{M as tt}from"./index-_pMv_sKm.js";import{u as rt}from"./useDrop-BKAPRNi5.js";import"./AlignRightOutlined-Kg291cY_.js";import"./UsergroupAddOutlined-Bx2neJ9_.js";import"./RedoOutlined-C4rr1ZME.js";import"./SwapRightOutlined-l_ApuJtI.js";import"./CaretDownOutlined-Cvfi80LL.js";import"./FilterFilled-BYB9ZItm.js";import"./ExclamationCircleOutlined-DHCAK7Yp.js";import"./MoreOutlined-C8o90ux3.js";import"./DoubleRightOutlined-FRvrxn3q.js";import"./DownOutlined-DnWdyoG8.js";import"./EditOutlined-D6nYSc60.js";import"./EnterOutlined-D0ebLqDC.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./PlusSquareOutlined-D0i2U-a9.js";import"./FolderOpenOutlined-Bj6jPccg.js";import"./FunctionOutlined-Dm0pzJNb.js";import"./HolderOutlined-CzOeoeCY.js";import"./InfoCircleOutlined-D9lj3ic_.js";import"./TeamOutlined-B9XPKo8Z.js";import"./NotificationOutlined-DlRBMYlM.js";import"./MinusOutlined-Cj88Lgeh.js";import"./QuestionCircleOutlined-Dza1yYuv.js";import"./ZoomOutOutlined-IpS0JADO.js";import"./SearchOutlined-DscCkqW9.js";import"./SyncOutlined-D_H3wSeZ.js";import"./UpOutlined-CkYvBYD1.js";import"./WarningFilled-DrN-C8wT.js";import"./LockOutlined-COu0XHB3.js";import"./PlusOutlined-BSTEPWl7.js";import"./action-CbrbshM_.js";import"./handleApi-CJLwph67.js";import"./request-C0MTnMVW.js";import"./util-DNkFm-j2.js";import"./_baseGet-xRkAGEE7.js";import"./project-RurpUGJo.js";import"./TextArea-D7VuO_-I.js";import"./BaseInput-4F0kfgVN.js";import"./useVariants-BdxfBOl3.js";import"./index-DOHCQObp.js";import"./index-1_6nT-oA.js";import"./row-pIc0FM19.js";import"./useBreakpoint-Dj2PHoq7.js";import"./useForceUpdate-Y5LXbfsE.js";import"./shallow-DkvW6rgF.js";import"./index-CcJLco_Z.js";import"./scrollTo-D0zr6O2z.js";import"./index-BIB-vVSn.js";import"./useIcons-CLAJNkrF.js";import"./index-DxJl0Bxc.js";import"./index-B5-G8EA2.js";import"./index-PKq6ibgt.js";import"./index-Dg1x3Ybx.js";import"./index-DfZhUM4Q.js";import"./useShowArrow-CIjY5B73.js";import"./List-BV6fBbjc.js";import"./index-wVmnK_0F.js";import"./conductUtil-wNhCxpcs.js";import"./index-B2mTmS5H.js";import"./index-Bp74baIv.js";import"./ColorPicker-CHwPjknD.js";import"./index-Do4qj9dd.js";import"./index-eEpHjpWF.js";import"./index-o7l-rjNw.js";import"./index-C-pH6dK5.js";import"./index-DIJm4IIM.js";import"./index-jIBCjwxt.js";import"./addEventListener-CKCD8Vpz.js";import"./index-CW6BFuNZ.js";import"./extendsObject-keMuGWqj.js";import"./Pagination-B_kLQQfV.js";import"./index-BytaExX6.js";import"./styleChecker-CQ-R2cXJ.js";import"./index-CAhQjzfH.js";import"./index-B6d_3ZHh.js";import"./index-DBzmE0wc.js";import"./index-zUAcsxVR.js";import"./index-9ch0MKpQ.js";import"./index-DFI99UhQ.js";import"./index-KkE6TN4K.js";import"./Table-ChTYBmDg.js";import"./createLoading-4QOu0SEw.js";import"./index-Dbrwdd6Z.js";import"./index-BUKMMZAh.js";import"./index-BmnSvrnD.js";import"./index-DYQX7UPG.js";/* empty css              */import"./omit-K9EDc_4o.js";import"./useDragDropManager-Dl0-aEZk.js";function ve(e,n){if(Be){if(!e)return n;var o;return pe(e)?o=e():"current"in e?o=e.current:o=e,o}}var nt=function(e){var n=function(o,a,i){var d=c.useRef(!1),l=c.useRef([]),v=c.useRef([]),f=c.useRef();e(function(){var x,j=Array.isArray(i)?i:[i],u=j.map(function(P){return ve(P)});if(!d.current){d.current=!0,l.current=u,v.current=a,f.current=o();return}(u.length!==l.current.length||!ae(l.current,u)||!ae(v.current,a))&&((x=f.current)===null||x===void 0||x.call(f),l.current=u,v.current=a,f.current=o())}),$e(function(){var x;(x=f.current)===null||x===void 0||x.call(f),d.current=!1})};return n},ot=nt(c.useEffect),at=typeof Element<"u",it=typeof Map=="function",st=typeof Set=="function",ct=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function J(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var o,a,i;if(Array.isArray(e)){if(o=e.length,o!=n.length)return!1;for(a=o;a--!==0;)if(!J(e[a],n[a]))return!1;return!0}var d;if(it&&e instanceof Map&&n instanceof Map){if(e.size!==n.size)return!1;for(d=e.entries();!(a=d.next()).done;)if(!n.has(a.value[0]))return!1;for(d=e.entries();!(a=d.next()).done;)if(!J(a.value[1],n.get(a.value[0])))return!1;return!0}if(st&&e instanceof Set&&n instanceof Set){if(e.size!==n.size)return!1;for(d=e.entries();!(a=d.next()).done;)if(!n.has(a.value[0]))return!1;return!0}if(ct&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(n)){if(o=e.length,o!=n.length)return!1;for(a=o;a--!==0;)if(e[a]!==n[a])return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf&&typeof e.valueOf=="function"&&typeof n.valueOf=="function")return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString&&typeof e.toString=="function"&&typeof n.toString=="function")return e.toString()===n.toString();if(i=Object.keys(e),o=i.length,o!==Object.keys(n).length)return!1;for(a=o;a--!==0;)if(!Object.prototype.hasOwnProperty.call(n,i[a]))return!1;if(at&&e instanceof Element)return!1;for(a=o;a--!==0;)if(!((i[a]==="_owner"||i[a]==="__v"||i[a]==="__o")&&e.$$typeof)&&!J(e[i[a]],n[i[a]]))return!1;return!0}return e!==e&&n!==n}var lt=function(n,o){try{return J(n,o)}catch(a){if((a.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw a}};const dt=ke(lt);var pt=function(e,n){return e===void 0&&(e=[]),n===void 0&&(n=[]),dt(e,n)},ft=function(e,n,o){var a=c.useRef(),i=c.useRef(0);pt(n,a.current)||(i.current+=1),a.current=n,ot(e,[i.current],o)},ut=/(mac|iphone|ipod|ipad)/i.test(typeof navigator<"u"?navigator==null?void 0:navigator.platform:""),ge={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pausebreak:19,capslock:20,esc:27,space:32,pageup:33,pagedown:34,end:35,home:36,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,insert:45,delete:46,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,leftwindowkey:91,rightwindowkey:92,meta:ut?[91,93]:[91,92],selectkey:93,numpad0:96,numpad1:97,numpad2:98,numpad3:99,numpad4:100,numpad5:101,numpad6:102,numpad7:103,numpad8:104,numpad9:105,multiply:106,add:107,subtract:109,decimalpoint:110,divide:111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,equalsign:187,comma:188,dash:189,period:190,forwardslash:191,graveaccent:192,openbracket:219,backslash:220,closebracket:221,singlequote:222},F={ctrl:function(e){return e.ctrlKey},shift:function(e){return e.shiftKey},alt:function(e){return e.altKey},meta:function(e){return e.type==="keyup"?ge.meta.includes(e.keyCode):e.metaKey}};function xe(e){return Oe(e)||fe(e)}function mt(e){var n=Object.keys(F).reduce(function(o,a){return F[a](e)?o+1:o},0);return[16,17,18,91,92].includes(e.keyCode)?n:n+1}function le(e,n,o){var a,i;if(!e.key)return!1;if(fe(n))return e.keyCode===n?n:!1;var d=n.split("."),l=0;try{for(var v=Z(d),f=v.next();!f.done;f=v.next()){var x=f.value,j=F[x],u=ge[x.toLowerCase()];(j&&j(e)||u&&u===e.keyCode)&&l++}}catch(P){a={error:P}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(a)throw a.error}}return o?l===d.length&&mt(e)===d.length?n:!1:l===d.length?n:!1}function ht(e,n){return pe(e)?e:xe(e)?function(o){return le(o,e,n)}:Array.isArray(e)?function(o){return e.find(function(a){return le(o,a,n)})}:function(){return!!e}}var vt=["keydown"];function Q(e,n,o){var a={},i=a.events,d=i===void 0?vt:i,l=a.target,v=a.exactMatch,f=v===void 0?!1:v,x=a.useCapture,j=x===void 0?!1:x,u=oe(n),P=oe(e);ft(function(){var S,I,b,w=ve(l,window);if(w){var p=function(E){var N,m=ht(P.current,f),s=m(E),k=xe(s)?s:E.key;if(s)return(N=u.current)===null||N===void 0?void 0:N.call(u,E,k)};try{for(var g=Z(d),_=g.next();!_.done;_=g.next()){var T=_.value;(b=w==null?void 0:w.addEventListener)===null||b===void 0||b.call(w,T,p,j)}}catch(E){S={error:E}}finally{try{_&&!_.done&&(I=g.return)&&I.call(g)}finally{if(S)throw S.error}}return function(){var E,N,m;try{for(var s=Z(d),k=s.next();!k.done;k=s.next()){var R=k.value;(m=w==null?void 0:w.removeEventListener)===null||m===void 0||m.call(w,R,p,j)}}catch($){E={error:$}}finally{try{k&&!k.done&&(N=s.return)&&N.call(s)}finally{if(E)throw E.error}}}}},[d],l)}const gt=c.memo(({hoverTarget:e,copyElement:n,pastElement:o,delElement:a})=>{var g,_,T,E,N,m;const{selectedElement:i,elements:d,nodeNav:l,isUpdateToolbar:v,setSelectedElement:f,moveElements:x}=U(s=>{var W;const k=(W=s.selectedElement)==null?void 0:W.id,R=k?s.page.pageData.elementsMap[k]:null,$={};if(R){if(R.parentId){const{id:q,type:r,name:y}=s.page.pageData.elementsMap[R.parentId];$.parent={id:q,type:r,name:y}}$.current={id:R.id,type:R.type,name:R.name};const z=Object.values(s.page.pageData.elementsMap).find(q=>q.parentId===R.id);z&&($.child={id:z.id,type:z.type,name:z.name})}return{selectedElement:s.selectedElement,elements:s.page.pageData.elements,nodeNav:$,isUpdateToolbar:s.isUpdateToolbar,setSelectedElement:s.setSelectedElement,moveElements:s.moveElements}}),[j,u]=c.useState({}),[P,S]=c.useState({}),[I,b]=c.useState("rightTop");c.useEffect(()=>{if(!i){u({}),b("");return}setTimeout(()=>{const s=document.querySelector(`[data-id=${i==null?void 0:i.id}]`);if(!s)return;const k=re(s);s.offsetLeft<144-k.width?b("bottomLeft"):s.offsetTop<24?b("bottomRight"):b("rightTop"),u(k)},50)},[i,d,v]),c.useEffect(()=>{if(e){const s=re(e);S({...s})}else S({...P,visibility:"hidden"})},[e]);const w=(s,{id:k,type:R})=>{!k||!R||(f({id:k,type:R}),s.stopPropagation())},p=(s,k)=>{x({componentId:i==null?void 0:i.id,direction:k}),s.stopPropagation()};return t.jsxs(t.Fragment,{children:[t.jsx("div",{className:i?"toolbar-box selected":"toolbar-box",style:j,id:"editorToolbar",children:t.jsxs("div",{className:"tool-bar "+I,children:[t.jsxs("div",{className:"node-nav",children:[l.parent&&t.jsx("span",{className:"node-tip parent",onClick:s=>w(s,l.parent),children:((g=l.parent)==null?void 0:g.name)||((_=l.parent)==null?void 0:_.type)}),t.jsx("span",{className:"node-tip current",onClick:s=>w(s,l.current),children:((T=l.current)==null?void 0:T.name)||((E=l.current)==null?void 0:E.type)}),l.child&&t.jsx("span",{className:"node-tip child",onClick:s=>w(s,l.child),children:((N=l.child)==null?void 0:N.name)||((m=l.child)==null?void 0:m.type)})]}),t.jsxs(V,{className:"actions",children:[t.jsx(O,{title:"上移动",children:t.jsx(ze,{onClick:s=>p(s,"up")})}),t.jsx(O,{title:"下移动",children:t.jsx(We,{onClick:s=>p(s,"down")})}),t.jsx(O,{title:"复制",children:t.jsx(ue,{onClick:s=>{n(),o(),s.stopPropagation()}})}),t.jsx(O,{title:"删除",children:t.jsx(me,{onClick:s=>{a(),s.stopPropagation()}})})]})]})}),t.jsx("div",{className:e?"toolbar-box hover":"toolbar-box",style:P})]})}),xt="_container_vzq3r_1",yt="_collectorContent_vzq3r_17",jt="_title_vzq3r_24",Ct="_expanded_vzq3r_29",wt="_itemList_vzq3r_33",Et="_item_vzq3r_33",kt="_active_vzq3r_55",_t="_action_vzq3r_59",It="_relatedItems_vzq3r_65",St="_iconContainer_vzq3r_72",bt="_iconButton_vzq3r_92",D={container:xt,collectorContent:yt,title:jt,expanded:Ct,itemList:wt,item:Et,active:kt,action:_t,relatedItems:It,iconContainer:St,iconButton:bt},Pt=()=>{const[e,n]=c.useState(!1),[o,a]=c.useState(null),[i,d]=c.useState([]),[l,v]=c.useState([]),[f,x]=c.useState([]),[j,u]=c.useState(1),{elementsMap:P,removeElements:S}=U(p=>({elementsMap:p.page.pageData.elementsMap,removeElements:p.removeElements}));c.useEffect(()=>{var p;d([]),v([]),(p=Object.keys(P).filter(g=>g.startsWith("Modal")||g.startsWith("Drawer")))==null||p.forEach(g=>{g.startsWith("Modal")?d(_=>[..._,{id:g,name:`Modal(${g})`}]):v(_=>[..._,{id:g,name:`Drawer(${g})`}])})},[P]),c.useEffect(()=>{x(j===1?i:l),n(e&&j===1?i.length>0:l.length>0)},[j,i,l]);const I=p=>{u(p),n(!e)},b=c.useCallback((p,g)=>{a(p.id),g==="double"&&(n(!1),Ke(p.id).open({}))},[]),w=c.useCallback(p=>{a(null),S(p)},[]);return t.jsxs("div",{className:D.container,children:[e&&t.jsx("div",{className:`${D.collectorContent} ${D.expanded}`,children:t.jsx("div",{className:D.itemList,children:f.map(p=>t.jsx(O,{title:"单击选中，双击打开",placement:"top",children:t.jsxs(M,{onClick:()=>b(p,"single"),onDoubleClick:()=>b(p,"double"),className:`${D.item} ${o===p.id?D.active:""}`,children:[t.jsx("span",{className:D.title,children:p.name}),t.jsx("span",{className:D.action,children:t.jsx(me,{style:{marginLeft:"5px"},onClick:g=>{g.stopPropagation(),w(p.id)}})})]})},p.id))})}),t.jsxs("div",{className:`${D.iconContainer} ${e?D.expanded:""}`,children:[t.jsxs(M,{disabled:i.length===0,className:D.iconButton,onClick:()=>I(1),children:[t.jsx(ce,{count:i.length,size:"small",color:"#7d3fff",showZero:!0,children:t.jsx(Rt,{})}),t.jsx("span",{style:{marginLeft:"5px"},children:"弹窗"})]}),t.jsxs(M,{disabled:l.length===0,className:D.iconButton,onClick:()=>I(2),children:[t.jsx(ce,{count:l.length,size:"small",color:"#7d3fff",showZero:!0,children:t.jsx(Nt,{})}),t.jsx("span",{style:{marginLeft:"5px"},children:"抽屉"})]})]})]})},Rt=()=>t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),t.jsx("path",{d:"M9 4v16M15 4v16",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeDasharray:"2 4"})]}),Nt=()=>t.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[t.jsx("path",{d:"M3 3h18a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",stroke:"currentColor",strokeWidth:"2"}),t.jsx("path",{d:"M15 3v18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),Dt="_designerBar_1402h_1",Lt="_hidden_1402h_11",Mt="_shareContent_1402h_14",Tt="_shareUser_1402h_18",$t="_visitLimit_1402h_23",Bt="_label_1402h_26",Ot="_footer_1402h_29",zt="_tips_1402h_35",B={designerBar:Dt,hidden:Lt,shareContent:Mt,shareUser:Tt,visitLimit:$t,label:Bt,footer:Ot,tips:zt},Wt=c.memo(()=>{const[e,n]=c.useState(!1),[o,a]=c.useState(!1),{userInfo:i,id:d,isPublic:l,savePageInfo:v}=U(u=>({userInfo:u.userInfo,id:u.page.id,isPublic:u.page.isPublic,savePageInfo:u.savePageInfo}));c.useEffect(()=>{a(l==1)},[l]);const f=c.useMemo(()=>`http://localhost:8090/page/${d}?env=stg`,[d]),x=()=>{He(f),n(!0),setTimeout(()=>{n(!1)},2e3)},j=async u=>{a(u),await Y.updatePageData({id:d,isPublic:u?1:2}),v({isPublic:u?1:2})};return t.jsxs("div",{className:B.shareContent,children:[t.jsx(Je,{readOnly:!0,value:f,addonAfter:e?"复制成功":t.jsx(ue,{onClick:x})}),t.jsxs("p",{className:B.shareUser,children:[t.jsx("span",{children:"管理员"}),t.jsxs("span",{className:B.tips,children:["(",t.jsx(Ae,{}),"：私有页面需添加开发者或体验者才可访问)"]})]}),t.jsx(O,{title:i.nickName,placement:"bottom",children:t.jsx(Ge,{src:i.avatar,style:{backgroundColor:"#87d068"},icon:t.jsx(Qe,{})})}),t.jsxs("p",{className:B.visitLimit,children:[t.jsx("span",{className:B.label,children:"访问权限"}),t.jsx(de,{checkedChildren:"公开",unCheckedChildren:"私有",checked:o,onChange:j})]}),t.jsxs("div",{className:B.footer,children:[t.jsx(M,{color:"primary",variant:"filled",icon:t.jsx(he,{}),onClick:()=>window.open(f,"_blank"),children:"一键访问"}),t.jsx(O,{title:t.jsx(Xe,{value:f,type:"svg",size:120}),placement:"right",color:"var(--mars-theme-bg-color)",children:t.jsx(M,{color:"primary",variant:"filled",icon:t.jsx(qe,{}),children:"二维码"})})]})]})}),At=c.memo(({canvasWidth:e,updateCanvas:n})=>{const[o,a]=c.useState(!1),[i,d]=c.useState(!1),l=c.useRef(),v=c.useRef(null),{mode:f,userInfo:x,id:j,name:u,remark:P,projectId:S,pageData:I,isEdit:b,setMode:w,updatePageState:p,updateEditState:g,savePageInfo:_}=U(m=>({mode:m.mode,userInfo:m.userInfo,id:m.page.id,name:m.page.name,remark:m.page.remark,projectId:m.page.projectId,pageData:m.page.pageData,isEdit:m.isEdit,setMode:m.setMode,updatePageState:m.updatePageState,updateEditState:m.updateEditState,savePageInfo:m.savePageInfo})),T=m=>{H.set("canvasWidth",m),n(m)},E=()=>{var m;(m=l.current)==null||m.open("edit",{id:j,name:u,remark:P,projectId:S})};c.useEffect(()=>(f==="edit"&&b&&i&&(v.current=setInterval(()=>{i&&N()},3e3)),()=>{v.current&&clearInterval(v.current)}),[b,i]);const N=async()=>{a(!0),console.log(I,j);try{await Y.updatePageData({id:j,pageData:JSON.stringify({...I,variableData:{},formData:{}})}),_e(JSON.stringify({...I,variableData:{},formData:{}}),()=>{console.log("isdone")}),window.localStorage.setItem(`pageData_${j}`,JSON.stringify({...I,variableData:{},formData:{}})),g(!1),p({env:"all"})}finally{a(!1)}};return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`${B.designerBar} ${f==="preview"?B.hidden:""}`,children:[t.jsxs("span",{style:{padding:"0 5px"},children:[t.jsx(M,{type:"text",icon:t.jsx(Ie,{}),onClick:()=>history.back(),children:"返回"}),t.jsx("span",{style:{marginLeft:"5px",fontSize:"14px"},children:u})]}),t.jsxs(V,{children:[t.jsx(Ze,{variant:"borderless",options:[{label:"1920px",value:"1920px"},{label:"1440px",value:"1440px"},{label:"1280px",value:"1280px"},{label:"1024px",value:"1024px"},{label:"960px",value:"960px"},{label:"自适应",value:"auto"}],style:{width:100},value:e,onChange:T}),t.jsx(M,{type:"text",icon:t.jsx(Fe,{}),onClick:E,children:"设置"}),t.jsx(M,{type:"text",icon:t.jsx(Ye,{}),onClick:N,loading:o,children:"保存"}),t.jsx(M,{type:"text",icon:t.jsx(et,{}),onClick:()=>w("preview"),children:"预览"})]}),t.jsxs(V,{children:[t.jsx(Se,{style:{padding:0},content:t.jsx(Wt,{}),title:t.jsx("h3",{children:"分享页面"}),trigger:"click",arrow:!1,placement:"bottomRight",children:t.jsx(M,{type:"text",icon:t.jsx(he,{}),children:"分享"})}),t.jsx(V,{children:t.jsx(O,{title:i?"自动保存已开启":"自动保存已关闭",placement:"bottom",children:t.jsx(de,{size:"small",checked:i,onChange:d})})})]})]}),t.jsx(Ve,{createRef:l})]})}),qt="_designer_b74jj_1",Ut="_pageWrapper_b74jj_30",X={designer:qt,"designer-editor":"_designer-editor_b74jj_18",pageWrapper:Ut},Kt=()=>{const{mode:e,isEdit:n,selectedElement:o,theme:a,elements:i,elementsMap:d,savePageInfo:l,addElement:v,addChildElements:f,setSelectedElement:x,removeElements:j,clearPageInfo:u,updateEditState:P}=U(r=>({page:r.page,mode:r.mode,isEdit:r.isEdit,selectedElement:r.selectedElement,theme:r.page.pageData.config.props.theme,elements:r.page.pageData.elements,elementsMap:r.page.pageData.elementsMap,savePageInfo:r.savePageInfo,addElement:r.addElement,addChildElements:r.addChildElements,setSelectedElement:r.setSelectedElement,removeElements:r.removeElements,clearPageInfo:r.clearPageInfo,updateToolbar:r.updateToolbar,updatePageState:r.updatePageState,updateEditState:r.updateEditState})),[S,I]=c.useState(null),[b,w]=c.useState(!1),[p,g]=c.useState("auto"),{id:_}=be(),T=Pe(),E=Re(({currentLocation:r,nextLocation:y})=>r.pathname!==y.pathname);c.useEffect(()=>{E.state==="blocked"&&(n?tt.confirm({title:"提示",content:"页面有未保存的内容，离开将失去修改内容",onOk:()=>{E.proceed()},onCancel:()=>{E.reset()}}):E.proceed())},[E]),c.useEffect(()=>{if(_)return console.log(_),w(!1),g(H.get("canvasWidth")||"auto"),Y.getPageDetail(_).then(r=>{let y={};try{y=r.pageData?JSON.parse(r.pageData):{config:se.config}}catch(h){y={config:se.config},console.error(h),console.info("【json数据】",r.pageData),G.error("页面数据格式错误，请检查")}l({...r,pageData:y}),setTimeout(()=>{P(!1)},100),w(!0)}).catch(r=>{if(r.code===403)return T("/403");if(r.code===404)return T("/404")}),()=>{u(),I(null),x(void 0)}},[_]),c.useEffect(()=>{const r=y=>{y.preventDefault(),y.returnValue=""};return window.addEventListener("beforeunload",r),()=>{window.removeEventListener("beforeunload",r)}},[]);const[,N]=rt({accept:"MENU_ITEM",async drop(r,y){var ee;if(y.didDrop())return;const{config:h,events:C,methods:L=[],elements:ye=[]}=((ee=await ie(r.type+"Config"))==null?void 0:ee.default)||{};if(!Me(r.type,o==null?void 0:o.id,o==null?void 0:o.type,d)){G.info("请把表单项放在Form容器内");return}const je=ye.map(async A=>{var te;const{config:Ce,events:we,methods:Ee=[]}=((te=await ie(A.type+"Config"))==null?void 0:te.default)||{};return{id:K(A.type),name:A.name,type:A.type,parentId:r.id,config:Ce,events:we,methods:Ee}})||[];Promise.all(je).then(A=>{v({type:r.type,name:r.name,id:r.id,config:h,events:C,methods:L,elements:A})})},collect:r=>({isOver:r.isOver(),canDrop:r.canDrop()})}),m=r=>{if(r.stopPropagation(),e==="preview")return;const h=r.target.closest("[data-id]");if(h){const C=h==null?void 0:h.dataset.id;if(C===(o==null?void 0:o.id))return;x({id:C,type:h==null?void 0:h.dataset.type}),I(null)}else o!=null&&o.id&&x(void 0)},s=r=>{const y=r.target;if(e==="preview")return;const h=y.closest("[data-id]");if(h){const C=h==null?void 0:h.dataset.id;if(C===(o==null?void 0:o.id)||C===(S==null?void 0:S.dataset.id))return;I(h)}else S&&I(null);r.stopPropagation()},{run:k}=Te(s,{wait:300});Q(["ctrl.c","meta.c"],r=>{["INPUT","TEXTAREA"].includes(r.target.tagName)||R()}),Q(["ctrl.v","meta.v"],r=>{["INPUT","TEXTAREA"].includes(r.target.tagName)||$()}),Q(["delete","backspace"],r=>{["INPUT","TEXTAREA"].includes(r.target.tagName)||r.target.contentEditable==="true"||z()});const R=()=>{H.set("copy_component",o==null?void 0:o.id)},$=()=>{var h;const r=H.get("copy_component");if(!r)return G.info("暂无复制内容");let y=(h=d[r])==null?void 0:h.parentId;if((o==null?void 0:o.id)!==r&&(y=o==null?void 0:o.id),y){const{element:C}=ne(i,r),L=K(r.split("_")[0]);f({...d[r],elements:[],parentId:y,id:L}),W((C==null?void 0:C.elements)||[],L)}else{const{element:C}=ne(i,r),L=K(r.split("_")[0]);v({...d[r],elements:[],id:L}),W((C==null?void 0:C.elements)||[],L)}};function W(r,y){var h;for(let C=0;C<r.length;C++){const L=K(r[C].id.split("_")[0]);f({...d[r[C].id],parentId:y,elements:[],id:L}),((h=r[C].elements)==null?void 0:h.length)>0&&W(r[C].elements,L)}}const z=()=>{o&&j(o.id)},q=c.useMemo(()=>{var y,h;return p!=="auto"?"":`${(h=(y=document.querySelector("#designer"))==null?void 0:y.getBoundingClientRect())==null?void 0:h.width}px`},[p]);return t.jsxs("div",{ref:N,className:X.designer,onClick:m,children:[t.jsx(At,{updateCanvas:g,canvasWidth:p}),t.jsx(Ne,{theme:{cssVar:!0,hashed:!1,algorithm:De.defaultAlgorithm,token:{colorPrimary:a||"#1677ff",colorLink:a||"#1677ff",colorInfo:a||"#1677ff"}},children:t.jsx("div",{id:"designer",className:X["designer-editor"],style:{height:e==="preview"?"calc(100vh - 64px)":"calc(100vh - 104px)"},children:t.jsxs("div",{id:"editor",className:X.pageWrapper,style:e==="preview"?{height:"calc(100vh - 64px)",overflow:"auto",padding:0}:{width:p==="auto"?q:p},onMouseOver:k,children:[e==="edit"&&t.jsx(gt,{copyElement:R,pastElement:$,delElement:z,hoverTarget:S}),t.jsx(Le.Suspense,{fallback:t.jsx("div",{children:"Loading..."}),children:b&&t.jsx(Ue,{})})]})})}),e==="edit"&&t.jsx(Pt,{})]})},Xn=c.memo(Kt);export{Xn as default};
