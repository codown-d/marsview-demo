import{r as o,a as L,H as N,u as G,j as e,E as y,i as w,B as i,m as F}from"./index-DmOc0qNU.js";import{M as O}from"./ColorPicker-B3zUbB0M.js";import{p as C}from"./project-RurpUGJo.js";import{a as P,M as E}from"./MemberSetting-nztnsBie.js";import{F as r}from"./index-1_6nT-oA.js";import{I as k}from"./index-B-YUPJxN.js";import{R as s}from"./index-DxJl0Bxc.js";import{R as V}from"./EditOutlined-D6nYSc60.js";import{a as R,R as q}from"./SaveOutlined-Da_V74JD.js";import{M as A}from"./index-_pMv_sKm.js";import{I as z}from"./index-jIBCjwxt.js";import{T as $}from"./index-DFI99UhQ.js";import"./ColorPicker-CHwPjknD.js";import"./useVariants-BdxfBOl3.js";import"./index-Do4qj9dd.js";import"./index-eEpHjpWF.js";import"./index-DSaINUG7.js";import"./useShowArrow-CIjY5B73.js";import"./List-BV6fBbjc.js";import"./index-wVmnK_0F.js";import"./useIcons-CLAJNkrF.js";import"./DownOutlined-DnWdyoG8.js";import"./SearchOutlined-DscCkqW9.js";import"./index-o7l-rjNw.js";import"./UpOutlined-CkYvBYD1.js";import"./BaseInput-4F0kfgVN.js";import"./index-DOHCQObp.js";import"./index-C-pH6dK5.js";import"./row-pIc0FM19.js";import"./QuestionCircleOutlined-Dza1yYuv.js";import"./TextArea-D7VuO_-I.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./EyeOutlined-QFSiY36E.js";import"./index-B5-G8EA2.js";import"./addEventListener-CKCD8Vpz.js";import"./ZoomOutOutlined-IpS0JADO.js";const H="_form_1jua5_1",U="_editBtn_1jua5_7",J="_delBtn_1jua5_20",v={form:H,editBtn:U,delBtn:J},Le=o.memo(()=>{const[d,n]=o.useState(!1),[c,p]=o.useState(!1),[h,j]=o.useState(0),[f,m]=o.useState(!1),[u,t]=o.useState("detail"),g=L(l=>l.userInfo.userId),{id:b}=N(),[x]=r.useForm(),B=G();o.useEffect(()=>{b&&C.getProjectDetail(parseInt(b)).then(l=>{x.setFieldsValue(l),j(l.userId)})},[]);const M=async()=>{try{await x.validateFields();const{breadcrumb:l,tag:S,footer:T,...D}=x.getFieldsValue();n(!0),await C.updateProject({...D,tag:S?1:0,footer:T?1:0,breadcrumb:l?1:0}),F.success("更新成功"),n(!1),t("detail")}catch{n(!1)}},_=()=>{m(!0)},I=async l=>{p(!0);try{await C.delProject({id:Number(b),type:l}),F.success("删除成功"),B("/projects")}finally{m(!1),p(!1)}},a={disabled:u==="detail",variant:u==="detail"?"borderless":"outlined"};return e.jsxs(e.Fragment,{children:[e.jsxs(r,{form:x,initialValues:{isPublic:1,layout:1,menuMode:"inline",menuThemeColor:"dark",systemThemeColor:"#1677ff",breadcrumb:!0,tag:!0,footer:!1,logo:"/imgs/mars-logo.png"},labelCol:{span:4},wrapperCol:{span:12},className:v.form,size:"middle",onFinish:M,children:[e.jsx(r.Item,{label:"项目ID",name:"id",hidden:!0,children:e.jsx(k,{})}),e.jsx("h3",{children:"基础配置"}),e.jsx(r.Item,{label:"项目名称",name:"name",rules:[{required:!0,message:"请输入项目名称"}],children:e.jsx(k,{placeholder:"项目名称: Mars",...a,maxLength:15,showCount:!0})}),e.jsx(r.Item,{label:"项目描述",name:"remark",rules:[{required:!0,message:"请输入项目描述"}],children:e.jsx(k.TextArea,{placeholder:"请输入项目描述",rows:3,maxLength:100,showCount:u!=="detail",...a})}),e.jsx(r.Item,{label:"LOGO",name:"logo",rules:[{required:!0,message:"请上传项目Logo"}],children:e.jsx(K,{})}),e.jsx("h3",{children:"系统配置"}),e.jsx(r.Item,{label:"系统布局",name:"layout",children:e.jsxs(s.Group,{...a,onChange:l=>x.setFieldValue("menuMode",l.target.value===1?"inline":"horizontal"),children:[e.jsx(s,{value:1,children:e.jsx("img",{style:{width:100},src:"/imgs/layout-1.png",alt:"左右布局"})}),e.jsx(s,{value:2,children:e.jsx("img",{style:{width:100},src:"/imgs/layout-2.png",alt:"上左右下布局"})})]})}),e.jsx(r.Item,{noStyle:!0,shouldUpdate:!0,children:l=>l.getFieldValue("layout")===1?e.jsx(r.Item,{label:"菜单模式",name:"menuMode",children:e.jsxs(s.Group,{...a,buttonStyle:"solid",children:[e.jsx(s.Button,{value:"vertical",children:"垂直"}),e.jsx(s.Button,{value:"inline",children:"内嵌"})]})}):e.jsx(r.Item,{label:"菜单模式",name:"menuMode",children:e.jsx(s.Group,{...a,buttonStyle:"solid",children:e.jsx(s.Button,{value:"horizontal",children:"水平"})})})}),e.jsx(r.Item,{label:"菜单主题",name:"menuThemeColor",children:e.jsxs(s.Group,{...a,children:[e.jsx(s,{value:"dark",children:"深色"}),e.jsx(s,{value:"light",children:"浅色"})]})}),e.jsx(r.Item,{label:"系统主题",name:"systemThemeColor",children:e.jsx(O,{...a})}),e.jsx(r.Item,{label:"面包屑",name:"breadcrumb",valuePropName:"checked",children:e.jsx(y,{...a})}),e.jsx(r.Item,{label:"多页签",name:"tag",valuePropName:"checked",children:e.jsx(y,{...a})}),e.jsx(r.Item,{label:"页脚",name:"footer",valuePropName:"checked",children:e.jsx(y,{...a})}),e.jsx("h3",{children:"权限配置"}),e.jsx(r.Item,{label:"访问权限",tooltip:"项目访问权限",extra:"公开项目所有人可访问；私有项目可通过RBAC分配菜单权限。",name:"isPublic",rules:[{required:!0,message:"请输入项目描述"}],children:e.jsxs(s.Group,{...a,children:[e.jsx(s,{value:1,children:"公开"}),e.jsx(s,{value:2,children:"私有"})]})}),e.jsx(r.Item,{label:"开发权限",tooltip:"项目配置修改权限",extra:"只有开发者才能修改当前项目配置。",children:e.jsx(Q,{ownerId:h})}),e.jsx("div",{className:v.editBtn,children:u==="detail"?e.jsxs(w,{children:[e.jsx(i,{type:"primary",icon:e.jsx(V,{}),onClick:()=>{t("edit")},children:"编辑"}),e.jsx(i,{icon:e.jsx(R,{}),onClick:()=>B("/projects"),children:"返回"})]}):e.jsxs(w,{children:[e.jsx(i,{type:"primary",icon:e.jsx(q,{}),loading:d,onClick:M,children:"保存"}),e.jsx(i,{icon:e.jsx(R,{}),onClick:()=>t("detail"),children:"取消"})]})}),e.jsx("h3",{children:"危险区域"}),e.jsx("div",{className:v.delBtn,children:e.jsx(i,{danger:!0,type:"primary",onClick:_,loading:c,disabled:h!==g,children:"删除项目"})})]}),e.jsxs(A,{open:f,title:"项目删除确认",centered:!0,onOk:()=>I(),onCancel:()=>m(!1),footer:[e.jsx(i,{onClick:()=>m(!1),children:"关闭"},"back"),e.jsx(i,{type:"primary",loading:c,onClick:()=>I(),children:"仅删除项目"},"submit"),e.jsx(i,{type:"primary",danger:!0,loading:c,onClick:()=>I("all"),children:"删除所有数据"},"link")],children:[e.jsx("p",{children:"1. 删除项目后，您将无法找回，请慎重操作！"}),e.jsx("p",{children:"2. 仅删除项目会保留项目下页面列表。"}),e.jsx("p",{children:"3. 删除所有数据，会彻底删除项目本身、菜单列表以及归属页面列表。"})]})]})}),K=({value:d})=>e.jsx(z,{src:d,style:{width:100}}),Q=({ownerId:d})=>{const n=N().id,c=o.useRef(),[p,h]=o.useState([]),j=L(t=>t.userInfo.userId);o.useEffect(()=>{n!="0"&&f()},[]);const f=async()=>{const t=await P.getMemberList({pageId:parseInt(n)});h(t.list)},m=()=>{var t;(t=c.current)==null||t.open(1,parseInt(n))},u=async t=>{await P.deletePageMember({id:t}),h(p.filter(g=>g.id!=t))};return e.jsxs(e.Fragment,{children:[e.jsx(w,{children:p.map(t=>e.jsx($,{color:"green",closable:d===j||t.userId===j,onClose:()=>u(t.id),children:t.userName},t.id))}),j==d&&e.jsx(i,{type:"link",onClick:m,children:"添加"}),e.jsx(E,{ref:c,update:f})]})};export{Le as default};
