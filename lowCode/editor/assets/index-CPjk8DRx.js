import{r as a,H as T,j as e,m as F,a8 as A,i as L,T as M,B as R,M as E}from"./index-DmOc0qNU.js";import{b as K,e as N,g as B,f as O,h as V,S as P,B as D,i as H}from"./BaseTable-lcejC0tI.js";import{F as o}from"./index-1_6nT-oA.js";import{M as v}from"./index-_pMv_sKm.js";import{I as S}from"./index-B-YUPJxN.js";import{T as $}from"./index-B6d_3ZHh.js";import{R as q}from"./QuestionCircleOutlined-Dza1yYuv.js";import{F as z}from"./Table-ChTYBmDg.js";import"./row-pIc0FM19.js";import"./index-DOHCQObp.js";import"./BaseInput-4F0kfgVN.js";import"./TextArea-D7VuO_-I.js";import"./useVariants-BdxfBOl3.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./EyeOutlined-QFSiY36E.js";import"./SearchOutlined-DscCkqW9.js";import"./List-BV6fBbjc.js";import"./conductUtil-wNhCxpcs.js";import"./PlusSquareOutlined-D0i2U-a9.js";import"./FolderOpenOutlined-Bj6jPccg.js";import"./HolderOutlined-CzOeoeCY.js";import"./index-B2mTmS5H.js";import"./styleChecker-CQ-R2cXJ.js";import"./addEventListener-CKCD8Vpz.js";import"./DownOutlined-DnWdyoG8.js";import"./index-Bp74baIv.js";import"./index-B5-G8EA2.js";import"./index-DxJl0Bxc.js";import"./scrollTo-D0zr6O2z.js";import"./useShowArrow-CIjY5B73.js";import"./index-wVmnK_0F.js";import"./useIcons-CLAJNkrF.js";import"./useBreakpoint-Dj2PHoq7.js";import"./useForceUpdate-Y5LXbfsE.js";import"./Pagination-B_kLQQfV.js";import"./DoubleRightOutlined-FRvrxn3q.js";import"./index-DSaINUG7.js";import"./FilterFilled-BYB9ZItm.js";import"./extendsObject-keMuGWqj.js";import"./CaretDownOutlined-Cvfi80LL.js";function _(h){const[I,f]=a.useState(!1),[x,j]=a.useState("create"),[w,c]=a.useState(!1),[s]=o.useForm(),{id:u}=T();a.useImperativeHandle(h.mRef,()=>({open:k}));const k=(r,m)=>{j(r),f(!0),c(!1),m&&s.setFieldsValue(m)},l=async()=>{if(await s.validateFields()&&u)try{c(!0);const{id:m,name:y,remark:g=""}=s.getFieldsValue();x==="create"?await K({name:y,remark:g,projectId:u}):await N({name:y,remark:g,id:m,projectId:u}),c(!1),F.success("操作成功"),d(),h.update()}catch{c(!1)}},d=()=>{s.resetFields(),f(!1)};return e.jsx(v,{title:x==="create"?"新增角色":"编辑角色",width:600,open:I,okText:"确定",cancelText:"取消",confirmLoading:w,onOk:l,onCancel:d,children:e.jsxs(o,{form:s,labelAlign:"right",labelCol:{span:4},children:[e.jsx(o.Item,{name:"id",hidden:!0,children:e.jsx(S,{})}),e.jsx(o.Item,{name:"name",label:"角色名称",rules:[{required:!0,message:"请输入角色名称"}],children:e.jsx(S,{placeholder:"请输入角色名称"})}),e.jsx(o.Item,{name:"remark",label:"备注",children:e.jsx(S.TextArea,{placeholder:"请输入备注",maxLength:20,showCount:!0})})]})})}function G(h){const[I,f]=a.useState(!1),[x,j]=a.useState([]),[w,c]=a.useState([]),[s,u]=a.useState(),[k,l]=a.useState(),d=T().id;a.useEffect(()=>{r()},[]);const r=async()=>{if(!d)return;const n=await B(),p=A(n.list);j(p||[])};a.useImperativeHandle(h.mRef,()=>({open:m}));const m=n=>{var p;f(!0),u(n),l({id:(s==null?void 0:s.id)||0,projectId:parseInt(d),checked:n.checked,halfChecked:n.halfChecked}),c(((p=n.checked)==null?void 0:p.split(",").map(C=>parseInt(C)))||[])},y=(n,p)=>{c(n);const C=[],i=[];p.checkedNodes.map(t=>{t.type===2||t.type===1&&!t.children?C.push(t.id):i.push(t.id)}),l({id:(s==null?void 0:s.id)||0,projectId:parseInt(d),checked:C.join(","),halfChecked:i.concat(p.halfCheckedKeys).join(",")})},g=async()=>{k&&(await O(),F.success("权限设置成功"),b(),h.update())},b=()=>{f(!1),l(void 0)};return e.jsx(v,{title:"设置权限",width:600,open:I,okText:"确定",cancelText:"取消",onOk:g,onCancel:b,children:e.jsxs(o,{labelAlign:"right",labelCol:{span:4},children:[e.jsx(o.Item,{label:"角色名称",children:s==null?void 0:s.name}),e.jsx(o.Item,{label:"权限",children:e.jsx($,{checkable:!0,defaultExpandAll:!0,fieldNames:{title:"name",key:"id",children:"children"},onCheck:y,checkedKeys:w,treeData:x})})]})})}function Ee(){const[h,I]=a.useState([]),[f,x]=a.useState(0),[j,w]=a.useState(1),[c,s]=a.useState(!1),[u]=o.useForm(),{id:k}=T(),l=a.useRef(),d=a.useRef();a.useEffect(()=>{r()},[]);const r=async(i=j)=>{if(!k)return;s(!0),u.getFieldsValue();const t=await V();s(!1),x((t==null?void 0:t.total)||0),I((t==null?void 0:t.list)||[])},m=i=>{w(i),r(i)},y=()=>{var i;(i=l.current)==null||i.open("create")},g=i=>{var t;(t=l.current)==null||t.open("edit",i)},b=i=>{k&&E.confirm({title:"确认",content:e.jsx("span",{children:"确认删除该角色吗？"}),async onOk(){F.success("删除成功"),await H(),r()}})},n=i=>{var t;(t=d.current)==null||t.open(i)},p=[{title:"角色名称",dataIndex:"name",key:"name",width:150,fixed:"left"},{title:"备注",dataIndex:"remark",key:"remark",width:150},{title:"创建人",dataIndex:"userName",key:"userName",width:200},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:180},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180},{title:"操作",key:"action",width:260,fixed:"right",render(i,t){return e.jsxs(L,{children:[e.jsx(R,{type:"text",onClick:()=>g(t),children:"编辑"}),e.jsx(R,{type:"text",onClick:()=>n(t),children:"设置权限"}),e.jsx(R,{type:"text",onClick:()=>b(t.id),danger:!0,children:"删除"})]})}}],C={current:j,total:f,pageSize:10,showTotal:i=>`共 ${i} 条`,onChange:m};return e.jsxs("div",{className:"role-wrap",children:[e.jsx(P,{form:u,submit:r,reset:r,children:e.jsx(o.Item,{name:"name",label:"角色名称",children:e.jsx(S,{placeholder:"请输入角色名称"})})}),e.jsx(D,{title:e.jsxs(L,{children:[e.jsx("span",{children:"角色列表"}),e.jsx(M,{title:"角色主要用来配置权限，一个用户对应一个角色，一个角色对应一批权限，从而实现菜单和按钮的显示控制。",children:e.jsx(q,{})})]}),action:e.jsx(R,{type:"primary",onClick:y,children:"新增"}),children:e.jsx(z,{bordered:!0,rowKey:"id",loading:c,columns:p,dataSource:h,pagination:C,scroll:{x:1100}})}),e.jsx(_,{mRef:l,update:r}),e.jsx(G,{mRef:d,update:r})]})}export{Ee as default};
