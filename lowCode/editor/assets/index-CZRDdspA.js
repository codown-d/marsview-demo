import{r as s,H as B,j as e,S as N,ae as q,m as E,i as V,T as D,B as T,M as H}from"./index-CY1Ymj4r.js";import{u as G}from"./index-DGBlI9oV.js";import{j as O,k as K,l as P,m as J,S as Q,B as W,n as X}from"./BaseTable-BAI4vChc.js";import{F as l}from"./index-BKDg-K48.js";import{M as Y}from"./index-ClLmsWSS.js";import{I as z}from"./index-Du8QL6nv.js";import{R as A}from"./index-CrCWvzoA.js";import{S as U}from"./index-CUKOry-Y.js";import{R as Z}from"./QuestionCircleOutlined-TTJW15q1.js";import{F as ee}from"./Table-DKwxKTfy.js";import"./debounce-HTNO8IKQ.js";import"./row-C5ps4gU6.js";import"./index-C1u3Ql-g.js";import"./BaseInput-Bka7TPzR.js";import"./TextArea-U5uDgpR6.js";import"./useVariants-B4R8rkTL.js";import"./EyeInvisibleOutlined-DDX5Jvzv.js";import"./EyeOutlined-B6CobvGR.js";import"./SearchOutlined-DZ2l1XJ5.js";import"./index-CVwKh-ii.js";import"./useShowArrow-C9phI0pM.js";import"./List-CfIaGhIa.js";import"./index-DYezmHfp.js";import"./useIcons-CYuILU2n.js";import"./DownOutlined-QYs-kCMH.js";import"./styleChecker-BBrBaNTm.js";import"./addEventListener-e8APPF7k.js";import"./index-BqJLt5d9.js";import"./conductUtil-oPofkrzY.js";import"./PlusSquareOutlined-D3cnUxWk.js";import"./FolderOpenOutlined-CDyAvlLT.js";import"./HolderOutlined-E1hrqN51.js";import"./index-CMyR3-Rp.js";import"./index-B5fUo_Hm.js";import"./scrollTo-hj5AlJ0c.js";import"./useBreakpoint-D-Sgac-T.js";import"./useForceUpdate-BsEHW89a.js";import"./Pagination-BhehRHa0.js";import"./DoubleRightOutlined-BcWxf5hS.js";import"./FilterFilled-S1ql0Sss.js";import"./extendsObject-keMuGWqj.js";import"./CaretDownOutlined-fvgXmNbc.js";function te(y){const[c]=l.useForm(),[u,b]=s.useState("create"),[I,p]=s.useState(1),[h,C]=s.useState([]),[F,f]=s.useState([]),[S,g]=s.useState(!1),[x,n]=s.useState(!1),[L,R]=s.useState(!1),[v,d]=s.useState(!1),m=B().id;s.useImperativeHandle(y.mRef,()=>({open:w}));const w=async(a,i)=>{b(a),g(!0),p((i==null?void 0:i.systemRole)||1),n(!0),d(!1);try{const j=await O(parseInt(m));f(j),n(!1),i&&m&&c.setFieldsValue({...i,projectId:parseInt(m)})}catch{n(!1)}},k=a=>{p(a)},{run:t}=G(a=>{a&&(R(!0),q().then(i=>{C([{label:i.userName,value:i.id}]),R(!1)}))},{wait:800}),r=async()=>{if(!m)return;if(await c.validateFields()){d(!0);const{id:i,systemRole:j,roleId:M="",user_info:{label:_,value:$}={label:"",value:""}}=c.getFieldsValue();try{u==="create"?await K({systemRole:j,userId:$,userName:_,projectId:parseInt(m),roleId:M}):await P({id:i,systemRole:j,roleId:M}),d(!1),E.success("操作成功"),o(),y.update()}catch{d(!1)}}},o=()=>{g(!1),p(1),c.resetFields()};return e.jsx(e.Fragment,{children:e.jsx(Y,{title:u==="create"?"添加用户":"编辑用户",width:600,open:S,okText:"确定",cancelText:"取消",confirmLoading:v,onOk:r,onCancel:o,children:e.jsx(N,{spinning:x,children:e.jsxs(l,{form:c,layout:"vertical",labelCol:{span:4},initialValues:{systemRole:1},style:{marginTop:20},children:[e.jsx(l.Item,{hidden:!0,name:"id",children:e.jsx(z,{})}),e.jsx(l.Item,{label:"系统角色",name:"systemRole",extra:"管理员拥有本系统所有功能权限，普通用户需要通过RBAC分配角色权限",children:e.jsxs(A.Group,{onChange:a=>k(a.target.value),children:[e.jsx(A,{value:1,children:"管理员"}),e.jsx(A,{value:2,children:"普通用户"})]})}),u==="create"&&e.jsx(l.Item,{label:"用户",name:"user_info",rules:[{required:!0,message:"请输入用户邮箱"}],extra:"该用户必须为系统已注册用户，最终通过此角色来控制用户访问",children:e.jsx(U,{labelInValue:!0,filterOption:!1,showSearch:!0,onSearch:t,notFoundContent:L?e.jsx(N,{size:"small"}):null,options:h,placeholder:"请输入用户完整邮箱"})}),I===2&&e.jsx(l.Item,{label:"角色",name:"roleId",rules:[{required:!0,message:"请输入菜单名称"}],extra:"若没有角色，可先去角色列表创建",children:e.jsx(U,{showSearch:!0,children:F.map(a=>e.jsx(U.Option,{value:a.id,children:a.name},a.id))})})]})})})})}function Ge(){const[y,c]=s.useState([]),[u,b]=s.useState(0),[I,p]=s.useState(1),[h,C]=s.useState([]),[F,f]=s.useState(!1),[S]=l.useForm(),g=B().id,x=s.useRef();s.useEffect(()=>{L(),n()},[]);const n=async(t=I)=>{try{f(!0);const{name:r}=S.getFieldsValue(),o=await J({pageNum:t,pageSize:10,projectId:parseInt(g),userName:r});f(!1),b((o==null?void 0:o.total)||0),c((o==null?void 0:o.list)||[])}catch{f(!1)}},L=async()=>{const t=await O();C(t||[])},R=t=>{p(t),n(t)},v=()=>{var t;(t=x.current)==null||t.open("create")},d=t=>{var r;(r=x.current)==null||r.open("edit",t)},m=t=>{H.confirm({title:"确认",content:`确认删除 ${t.userName} 吗？`,onOk(){X({id:t.id}).then(()=>{E.success("删除成功"),n()})}})},w=[{title:"用户名称",dataIndex:"userName",key:"userName"},{title:"系统角色",dataIndex:"systemRole",render(t){return t===1?"管理员":"普通用户"}},{title:"角色列表",dataIndex:"roleId",render(t){var r;return(r=h==null?void 0:h.find(o=>o.id===t))==null?void 0:r.name}},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt"},{title:"操作",key:"action",render(t,r){return e.jsxs(V,{children:[e.jsx(T,{type:"text",onClick:()=>d(r),children:"编辑"}),e.jsx(T,{type:"text",danger:!0,onClick:()=>m(r),children:"删除"})]})}}],k={current:I,total:u,pageSize:10,showTotal:t=>`共 ${t} 条`,onChange:R};return e.jsxs("div",{children:[e.jsx(Q,{form:S,submit:n,reset:n,children:e.jsx(l.Item,{label:"用户名称",name:"name",children:e.jsx(z,{placeholder:"用户名称"})})}),e.jsx(W,{title:e.jsxs(V,{children:[e.jsx("span",{children:"用户列表"}),e.jsx(D,{title:"添加项目对应的用户，管理员默认具备该项目所有权限，普通用户可分配角色来精细化控制菜单和按钮。",children:e.jsx(Z,{})})]}),action:e.jsx(T,{type:"primary",onClick:v,children:"添加"}),children:e.jsx(ee,{bordered:!0,rowKey:"id",loading:F,columns:w,dataSource:y,pagination:k})}),e.jsx(te,{mRef:x,update:n})]})}export{Ge as default};
