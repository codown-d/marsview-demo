import{r as n,k as A,j as e,H as D,a8 as B,d as $,S as q,m as M,B as k,L as G,M as H}from"./index-DmOc0qNU.js";import{g as E,a as U,u as K,S as W,B as Z,c as J,d as Q}from"./BaseTable-lcejC0tI.js";import{C as X}from"./CreatePage-unumot6h.js";import{i as T}from"./index-C3QLbPSd.js";import{d as P}from"./styled-components.browser.esm-DpSOJZe5.js";import{S as w}from"./index-DSaINUG7.js";import{S as Y}from"./index-eEpHjpWF.js";import{F as s}from"./index-1_6nT-oA.js";import{M as ee}from"./index-_pMv_sKm.js";import{I}from"./index-B-YUPJxN.js";import{T as O}from"./index-o7l-rjNw.js";import{T as te}from"./index-CAhQjzfH.js";import{R as u}from"./index-DxJl0Bxc.js";import{F as re}from"./Table-ChTYBmDg.js";import{B as V}from"./SoundOutlined-C2LYByLL.js";import"./project-RurpUGJo.js";import"./TextArea-D7VuO_-I.js";import"./BaseInput-4F0kfgVN.js";import"./useVariants-BdxfBOl3.js";import"./index-DOHCQObp.js";import"./AlignRightOutlined-Kg291cY_.js";import"./UsergroupAddOutlined-Bx2neJ9_.js";import"./RedoOutlined-C4rr1ZME.js";import"./SwapRightOutlined-l_ApuJtI.js";import"./CaretDownOutlined-Cvfi80LL.js";import"./FilterFilled-BYB9ZItm.js";import"./ExclamationCircleOutlined-DHCAK7Yp.js";import"./CopyOutlined-BRIAy90h.js";import"./DeleteOutlined-BnUSKaGo.js";import"./MoreOutlined-C8o90ux3.js";import"./DoubleRightOutlined-FRvrxn3q.js";import"./DownOutlined-DnWdyoG8.js";import"./EditOutlined-D6nYSc60.js";import"./EnterOutlined-D0ebLqDC.js";import"./EyeInvisibleOutlined-Cl_PTdo5.js";import"./EyeOutlined-QFSiY36E.js";import"./PlusSquareOutlined-D0i2U-a9.js";import"./FolderOpenOutlined-Bj6jPccg.js";import"./FunctionOutlined-Dm0pzJNb.js";import"./HolderOutlined-CzOeoeCY.js";import"./InfoCircleOutlined-D9lj3ic_.js";import"./TeamOutlined-B9XPKo8Z.js";import"./NotificationOutlined-DlRBMYlM.js";import"./MinusOutlined-Cj88Lgeh.js";import"./QuestionCircleOutlined-Dza1yYuv.js";import"./SaveOutlined-Da_V74JD.js";import"./ZoomOutOutlined-IpS0JADO.js";import"./SearchOutlined-DscCkqW9.js";import"./SettingOutlined-CGW_ik-t.js";import"./SyncOutlined-D_H3wSeZ.js";import"./UpOutlined-CkYvBYD1.js";import"./WarningFilled-DrN-C8wT.js";import"./LockOutlined-COu0XHB3.js";import"./PlusOutlined-BSTEPWl7.js";import"./UserOutlined-DAUrDjKa.js";import"./useShowArrow-CIjY5B73.js";import"./List-BV6fBbjc.js";import"./index-wVmnK_0F.js";import"./useIcons-CLAJNkrF.js";import"./row-pIc0FM19.js";import"./conductUtil-wNhCxpcs.js";import"./index-B6d_3ZHh.js";import"./index-B2mTmS5H.js";import"./index-B5-G8EA2.js";import"./styleChecker-CQ-R2cXJ.js";import"./addEventListener-CKCD8Vpz.js";import"./index-Bp74baIv.js";import"./scrollTo-D0zr6O2z.js";import"./useBreakpoint-Dj2PHoq7.js";import"./useForceUpdate-Y5LXbfsE.js";import"./Pagination-B_kLQQfV.js";import"./extendsObject-keMuGWqj.js";const ae=P.div`
  display: flex;
  flex-wrap: wrap;
  width: 100%;
  height: 300px;
  overflow: auto;
`,se=P.div`
  width: 50px;
  height: 50px;
  padding: 10px;
  cursor: pointer;
`;function ne({value:j,onChange:l}){const[f,h]=n.useState(!1),[c,b]=n.useState("线框风格"),d=n.useMemo(()=>{const i=T;return Object.keys(T).filter(p=>!["default","createFromIconfontCN","getTwoToneColor","setTwoToneColor","IconProvider"].includes(p)).map(p=>({value:p,label:A.createElement(i[p],{style:{fontSize:"24px",verticalAlign:"middle"}})}))},[]),m=n.useMemo(()=>d.filter(i=>i.value.includes("Outlined")),[]),C=n.useMemo(()=>d.filter(i=>i.value.includes("Filled")),[]),v=n.useMemo(()=>d.filter(i=>i.value.includes("TwoTone")),[]),y=n.useMemo(()=>{switch(c){case"线框风格":return m;case"实底风格":return C;default:return v}},[c]);return e.jsx(w,{placeholder:"请选择图标",allowClear:!0,value:j,open:f,options:y,onDropdownVisibleChange:i=>h(i),onClear:()=>l(""),dropdownRender:()=>e.jsxs("div",{children:[e.jsx(Y,{options:["线框风格","实底风格","双色风格"],block:!0,value:c,onChange:b}),e.jsx(ae,{children:y.map(i=>e.jsx(se,{onClick:()=>{l(i.value),h(!1)},children:i.label},i.value))})]})})}function ie(j){const[l]=s.useForm(),f=n.useRef(),[h,c]=n.useState("create"),[b,d]=n.useState(!1),[m,C]=n.useState([]),[v,y]=n.useState([]),[i,p]=n.useState(!1),[F,S]=n.useState(!1),{id:t}=D();n.useImperativeHandle(j.mRef,()=>({open:r}));const r=async(o,a)=>{var x;c(o),d(!0),p(!0),g(),o==="edit"&&L(),p(!1),a&&t&&l.setFieldsValue({...a,projectId:parseInt(t),code:((x=a.code)==null?void 0:x.split("_")[2])||""})},g=async()=>{if(!t)return;const o=await E(),a=l.getFieldValue("parentId"),x=o.list.filter(R=>R.type===1&&R.parentId!=a),z=B(x);C(z)},L=async()=>{const o=await $.getPageList({pageNum:1,pageSize:50,projectId:Number(t)});y(o.list)},_=async()=>{if(await l.validateFields()){S(!0);const a=l.getFieldsValue();try{a.type===2?a.code=a.projectId+"_"+a.parentId+"_"+a.code:a.code="",a.pageId=a.pageId||0,h==="create"?await U(a):await K(a),S(!1),M.success("操作成功"),N(),j.update()}catch{S(!1)}}},N=()=>{d(!1),l.resetFields()};return e.jsxs(e.Fragment,{children:[e.jsx(ee,{title:h==="create"?"创建菜单":"编辑菜单",width:800,open:b,okText:"确定",cancelText:"取消",confirmLoading:F,onOk:_,onCancel:N,children:e.jsx(q,{spinning:i,children:e.jsxs(s,{form:l,labelAlign:"right",labelCol:{span:4},wrapperCol:{span:18},initialValues:{type:1,status:1,isCreate:2},children:[e.jsx(s.Item,{hidden:!0,name:"id",children:e.jsx(I,{})}),e.jsx(s.Item,{hidden:!0,name:"projectId",children:e.jsx(O,{})}),e.jsx(s.Item,{label:"父级菜单",name:"parentId",children:e.jsx(te,{placeholder:"请选择父级菜单",allowClear:!0,treeDefaultExpandAll:!0,fieldNames:{label:"name",value:"id"},treeData:m})}),e.jsx(s.Item,{label:"菜单类型",name:"type",children:e.jsxs(u.Group,{children:[e.jsx(u,{value:1,children:"菜单"}),e.jsx(u,{value:2,children:"按钮"}),e.jsx(u,{value:3,children:"页面"})]})}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const o=l.getFieldValue("type");return o===1?e.jsx(s.Item,{label:"菜单名称",name:"name",rules:[{required:!0,message:"请输入菜单名称"}],children:e.jsx(I,{placeholder:"请输入菜单名称",allowClear:!0,maxLength:15,showCount:!0})}):o===2?e.jsx(s.Item,{label:"按钮名称",name:"name",rules:[{required:!0,message:"请输入按钮名称"}],children:e.jsx(I,{placeholder:"请输入按钮名称",allowClear:!0})}):e.jsx(s.Item,{label:"页面名称",name:"name",rules:[{required:!0,message:"请输入页面名称"}],children:e.jsx(I,{placeholder:"请输入页面名称",allowClear:!0})})}}),e.jsx(s.Item,{noStyle:!0,shouldUpdate:!0,children:()=>{const o=l.getFieldValue("type");return o===2?e.jsx(s.Item,{label:"权限标识",name:"code",extra:"同一个菜单下按钮标识不要重复，请根据语义定义。",children:e.jsx(I,{placeholder:"权限标识，例如: create、edit、export"})}):e.jsxs(e.Fragment,{children:[o===1?e.jsx(s.Item,{label:"菜单图标",name:"icon",children:e.jsx(ne,{})}):null,h==="edit"?e.jsx(s.Item,{label:"绑定页面",extra:e.jsxs("span",{children:["该菜单可以解绑、修改、新增绑定页面。暂无页面？",e.jsx("a",{onClick:()=>{var a;(a=f.current)==null||a.open("create",{id:0,name:"",projectId:Number(t)})},children:"去创建"})]}),name:"pageId",children:e.jsx(w,{placeholder:"请选择关联页面",allowClear:!0,showSearch:!0,filterOption:(a,x)=>((x==null?void 0:x.name)??"").toLowerCase().includes(a.toLowerCase()),options:[...v,{name:"空页面",id:0}],fieldNames:{label:"name",value:"id"}})}):e.jsx(s.Item,{label:"生成页面",name:"isCreate",extra:"如果你创建的是末级菜单，请给它生成一个页面，父菜单不需要生成。",children:e.jsxs(u.Group,{children:[e.jsx(u,{value:1,children:"是"}),e.jsx(u,{value:2,children:"否"})]})}),e.jsx(s.Item,{label:"页面路由",name:"path",extra:"配置页面路由后，访问时会优先使用页面路由",rules:[{pattern:/^\/?[^\d][a-zA-Z-_/]+.*$/g,message:"页面路由不能以数字开头，且不能包含特殊字符"}],children:e.jsx(I,{placeholder:"请输入页面路径，例如: /dashboard"})})]})}}),e.jsx(s.Item,{label:"排序",name:"sortNum",extra:"排序值越大越靠后。",children:e.jsx(O,{placeholder:"请输入排序值"})}),e.jsx(s.Item,{label:"菜单状态",name:"status",extra:"停用后，菜单不会在admin系统中展示。",children:e.jsxs(u.Group,{children:[e.jsx(u,{value:1,children:"启用"}),e.jsx(u,{value:2,children:"停用"})]})})]})})}),e.jsx(X,{createRef:f,update:()=>L()})]})}function St(){const[j]=s.useForm(),[l,f]=n.useState([]),[h,c]=n.useState(!1),b=D().id,d=n.useRef();n.useEffect(()=>{m()},[]);const m=async()=>{const{name:t,status:r}=j.getFieldsValue();if(!b)return;c(!0);const g=await E();if(c(!1),t||r>0)f(g.list||[]);else{const L=B(g.list);f(L||[])}},C=()=>{var t;(t=d.current)==null||t.open("create",{sortNum:l.length})},v=async t=>{c(!0),await J({id:t.id}),M.success("复制成功"),m()},y=t=>{var r,g;(g=d.current)==null||g.open("create",{parentId:t.id,sortNum:(((r=t.children)==null?void 0:r.length)||0)+1})},i=t=>{var r;(r=d.current)==null||r.open("edit",t,l)},p=t=>{let r="";t.type==1&&(r="菜单"),t.type==2&&(r="按钮"),t.type==3&&(r="页面"),H.confirm({title:"确认",content:`${r}删除后不可恢复，确认删除吗？`,onOk(){F(t.id)}})},F=async t=>{c(!0),await Q(),M.success("删除成功"),m()},S=[{title:"菜单名称",dataIndex:"name",key:"name",width:220,align:"center",fixed:"left"},{title:"菜单图标",dataIndex:"icon",key:"icon",align:"center",width:120,render(t){if(!t)return"-";const r=T;return A.createElement(r[t],{style:{fontSize:"25px"}})}},{title:"菜单类型",dataIndex:"type",key:"type",align:"center",width:120,render(t){return{1:"菜单",2:"按钮",3:"页面"}[t]}},{title:"权限标识",dataIndex:"code",key:"code",align:"center",width:120,render(t){return t||"-"}},{title:"绑定页面",dataIndex:"pageId",key:"pageId",align:"center",width:120,render(t){return t}},{title:"排序值",dataIndex:"sortNum",key:"sortNum",align:"center",width:100},{title:"状态",dataIndex:"status",key:"status",align:"center",width:120,render(t){if(t===1)return e.jsx(V,{status:"success",text:"正常"});if(t===2)return e.jsx(V,{status:"error",text:"停用"})}},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",align:"center",width:180},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center",width:180},{title:"创建人",dataIndex:"userName",key:"userName",align:"center",width:200},{title:"操作",key:"action",width:320,fixed:"right",render(t,r){return e.jsxs(e.Fragment,{children:[e.jsx(k,{type:"link",onClick:()=>v(r),children:"复制"}),e.jsx(k,{type:"link",onClick:()=>y(r),children:"新增"}),e.jsx(k,{type:"link",onClick:()=>i(r),children:"编辑"}),e.jsx(k,{type:"link",danger:!0,onClick:()=>p(r),children:"删除"}),r.pageId>0&&e.jsx(G,{to:`/editor/${r.pageId}/edit`,children:"去设计"})]})}}];return e.jsxs("div",{children:[e.jsxs(W,{form:j,initialValues:{status:-1},submit:m,reset:m,children:[e.jsx(s.Item,{label:"菜单名称",name:"name",children:e.jsx(I,{placeholder:"菜单名称"})}),e.jsx(s.Item,{label:"菜单状态",name:"status",children:e.jsxs(w,{style:{width:100},children:[e.jsx(w.Option,{value:-1,children:"所有"}),e.jsx(w.Option,{value:1,children:"正常"}),e.jsx(w.Option,{value:2,children:"停用"})]})})]}),e.jsx(Z,{title:"菜单列表",action:e.jsx(k,{type:"primary",onClick:C,children:"新增"}),children:e.jsx(re,{bordered:!0,rowKey:"id",loading:h,columns:S,dataSource:l,pagination:!1,scroll:{x:1100}})}),e.jsx(ie,{mRef:d,update:m})]})}export{St as default};
