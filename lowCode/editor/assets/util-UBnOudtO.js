import{f as a,a as b,dl as T}from"./index-CY1Ymj4r.js";import{c as E}from"./index-yDMkoRSw.js";import{b as A}from"./_baseGet-C1wBFXxd.js";function L(t,e,n){var r=t==null?void 0:A(t,e);return r===void 0?n:r}const R=(t="mars",e=11)=>t+"_"+Number(Math.random().toString().substring(2,12)+Date.now()).toString(36).slice(0,e),W=(t,e)=>{if(!t)return"0.00";const n=parseFloat(t.toString());return isNaN(n)?t:e?n.toLocaleString("zh-CN",{style:e,currency:"CNY"}):n.toLocaleString()},_=(t,e="YYYY-MM-DD HH:mm:ss")=>t?a(t).format(e):"",$=t=>{const e=new Date;if(t)return t=="today"?a(e.toLocaleString()):(t=="yesterday"&&e.setDate(e.getDate()-1),t=="last7"&&e.setDate(e.getDate()-7),t=="last30"&&e.setMonth(e.getMonth()-1),t=="last90"&&e.setMonth(e.getMonth()-3),a(e.toLocaleString()))},H=t=>{const e=new Date,n=new Date;if(!t)return[void 0,void 0];if(["today","curWeek","curMonth","curYear","curQuarter"].includes(t)){if(t!="today"){if(t=="curWeek")e.setDate(e.getDate()-e.getDay()+1);else if(t=="curMonth")e.setDate(1);else if(t=="curYear")e.setDate(1),e.setMonth(0);else if(t=="curQuarter"){e.setDate(1);const r=e.getMonth();e.setMonth(Math.floor(r/3)*3)}}return[a(e.toLocaleString()),a(n.toLocaleString())]}if(["yesterday","lastWeek","lastMonth","last3Month","lastYear"].includes(t))return t=="yesterday"?e.setDate(e.getDate()-1):t=="lastWeek"?e.setDate(e.getDate()-7):t=="lastMonth"?e.setMonth(e.getMonth()-1):t=="last3Month"?e.setMonth(e.getMonth()-3):t=="lastYear"&&e.setFullYear(e.getFullYear()-1),[a(e.toLocaleString()),a(n.toLocaleString())]},I=t=>t==null,h=t=>!(t===""||t===void 0||t===null);function V(t){return E(t)}function k(t,e){return t==null?void 0:t.replace(/\$\{([^}]+)\}/g,(n,r)=>{if(r.includes("?"))try{return new Function("param",`return param.${r}`)(e)}catch{return r}return L(e,r)||""})}function P(t){const e=b.getState().page.pageData,n={};return e.variables.forEach(r=>{n[r.name]=e.variableData[r.name]??r.defaultValue}),t?n[t]:n}function w(t,e){const n=e.replace(/^\s*\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),r=Array.isArray(t)?t.join(", "):t;if(n.startsWith("function"))return new Function(r,`return ${n};`);const o=n.indexOf("return")>-1?n:`return ${n};`;return new Function(r,o)}function F(t,e={}){try{if(!t)return"";const n=t.match(/([A-Za-z]+_\w+)\.[\w\.]*/g)||[],r=[...new Set(n.map(c=>c.split(".")[0]))],o=["context","eventParams"],{page:{pageData:f},userInfo:p}=b.getState(),i=T(f.formData||{});r.forEach(c=>{var D;const m=((D=f.formData)==null?void 0:D[c])||{};i!=null&&i.id||(i[c]=m)});const g=P(),s=w(o,t),M={store:p,variable:g,eventParams:e,FORMAT:(c,m="YYYY-MM-DD HH:mm:ss")=>a(c).format(m),...i},u=s(M,e||{});return typeof u=="function"?u(M,e||{}):u}catch(n){console.error("表达式解析失败：",n)}return""}const N=(t,e)=>{var n;for(let r=0;r<t.length;r++){const o=t[r];["DatePicker","TimePicker","DatePickerRange","TimePickerRange","EditTable"].includes(o.type)?e.push(o.id):(n=o.elements)!=null&&n.length&&N(o.elements,e)}return e},j=(t,e)=>{const n=b.getState().page.pageData.elementsMap;return N(t,[]).map(o=>{var u,c,m,D;const{type:f,config:p}=n[o],{startField:i,endField:g,formItem:{name:s},formWrap:{format:S,columns:M}}=p.props;if(["DatePicker","TimePicker"].includes(f)){if(!e[s])return;e[s]=((c=(u=e[s])==null?void 0:u.format)==null?void 0:c.call(u,S))||a(e[s])}else if(["DatePickerRange","TimePickerRange"].includes(f))if(((m=e[s])==null?void 0:m.length)==2){const[l,y]=((D=e[s])==null?void 0:D.map(d=>{var Y;return((Y=d==null?void 0:d.format)==null?void 0:Y.call(d,S))||a(e[d])}))||[void 0,void 0];i&&g&&(e[i]=l,e[g]=y,delete e[s])}else e[i]&&e[g]&&(e[s]=[a(e[i]),a(e[g])]);else f==="EditTable"&&M.filter(l=>l.type==="date").map(({dataIndex:l})=>{e[s].map(y=>{y[l]&&(y[l]=a(y[l]))})})}),e},B=(t={},e)=>Object.keys(t).reduce((n,r)=>{const o=t[r];return typeof o=="object"?(o==null?void 0:o.type)==="static"?n[r]=o.value:(o==null?void 0:o.type)==="variable"?n[r]=F(o.value,e):n[r]=o:n[r]=o,n},{}),z=(t=[],e={})=>t.reduce((n,r)=>{if(r.key)if(typeof r.value=="string")if(h(r.value)){const o=k(r.value,e);n[r.key]=h(o)?isNaN(o)?o:Number(o):""}else n[r.key]="";else if(r.value.type==="static")if(h(r.value.value)){const o=k(r.value.value,e);n[r.key]=h(o)?isNaN(o)?o:Number(o):""}else n[r.key]="";else{const o=F(r.value.value,e);n[r.key]=h(o)?o:""}return n},{}),C=(t,e)=>{if(e)return new Promise((n,r)=>{if(document.getElementById(t))return;const o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=e,o.onload=n,o.onerror=r,o.setAttribute("id",t),document.getElementsByTagName("HEAD")[0].appendChild(o)})},O=t=>new Promise((e,n)=>{const r=document.createElement("script");r.type="text/javascript",r.defer=!0,r.onload=e,r.onerror=n,r.src=t,document.body.append(r)}),Q=()=>"stg",G=t=>{if(t)return e=>{try{return new Function("value",`return (${t})(value);`)(e)}catch(n){return console.error("formatter 函数解析失败：",n),e}}},J=Object.freeze(Object.defineProperty({__proto__:null,copyText:V,createFunction:w,createId:R,dateFormat:j,formatDate:_,formatNumber:W,getDateByType:$,getDateItem:N,getDateRangeByType:H,getEnv:Q,getPageVariable:P,handleArrayVariable:z,handleFormatter:G,handleParamVariable:B,isNotEmpty:h,isNull:I,loadScript:O,loadStyle:C,renderFormula:F,renderTemplate:k},Symbol.toStringTag,{value:"Module"}));export{_ as a,$ as b,R as c,j as d,H as e,W as f,L as g,I as h,h as i,B as j,z as k,C as l,k as m,V as n,G as o,F as r,J as u};
